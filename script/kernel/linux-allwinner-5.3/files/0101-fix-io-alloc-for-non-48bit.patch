From 11d9995ac5bdb78fe01e2d14a9c7dec891712cae Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Cl=C3=A9ment=20P=C3=A9ron?= <peron.clem@gmail.com>
Date: Wed, 29 May 2019 22:55:46 +0200
Subject: [PATCH 31/39] fix io alloc for non-48bit

---
 drivers/iommu/io-pgtable-arm.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/iommu/io-pgtable-arm.c b/drivers/iommu/io-pgtable-arm.c
index 082efc4..a69b9b5 100644
--- a/drivers/iommu/io-pgtable-arm.c
+++ b/drivers/iommu/io-pgtable-arm.c
@@ -1022,7 +1022,9 @@ arm_mali_lpae_alloc_pgtable(struct io_pgtable_cfg *cfg, void *cookie)
 	iop = arm_64_lpae_alloc_pgtable_s1(cfg, cookie);
 	if (iop) {
 		u64 mair, ttbr;
+		struct arm_lpae_io_pgtable *data = io_pgtable_ops_to_data(&iop->ops);
 
+		data->levels = 4;
 		/* Copy values as union fields overlap */
 		mair = cfg->arm_lpae_s1_cfg.mair[0];
 		ttbr = cfg->arm_lpae_s1_cfg.ttbr[0];
-- 
2.7.1

