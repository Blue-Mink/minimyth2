
Add conditionals for 5.19.2+ kernels accordingly to
https://www.spinics.net/lists/kernel/msg4473779.html


diff --speed-large-files --no-dereference --minimal -Naur 8821cu-20210118-a27e9dd621480ac2a28441bc6c7732e0e58ddd8d/os_dep/linux/ioctl_cfg80211.c 8821cu-20210118-a27e9dd621480ac2a28441bc6c7732e0e58ddd8d/os_dep/linux/ioctl_cfg80211.c
--- 8821cu-20210118-a27e9dd621480ac2a28441bc6c7732e0e58ddd8d/os_dep/linux/ioctl_cfg80211.c	2022-07-28 03:19:51.000000000 +0200
+++ 8821cu-20210118-a27e9dd621480ac2a28441bc6c7732e0e58ddd8d/os_dep/linux/ioctl_cfg80211.c	2022-08-18 21:54:22.676651252 +0200
@@ -475,7 +475,11 @@
 	if (!rtw_cfg80211_allow_ch_switch_notify(adapter))
 		goto exit;
 
+	#if (LINUX_VERSION_CODE >= KERNEL_VERSION(5, 19, 2))
+	cfg80211_ch_switch_notify(adapter->pnetdev, &chdef, 0);
+	#else
 	cfg80211_ch_switch_notify(adapter->pnetdev, &chdef);
+	#endif
 
 #else
 	int freq = rtw_ch2freq(ch);
@@ -490,7 +494,11 @@
 	}
 
 	ctype = rtw_chbw_to_nl80211_channel_type(ch, bw, offset, ht);
+	#if (LINUX_VERSION_CODE >= KERNEL_VERSION(5, 19, 2))
+	cfg80211_ch_switch_notify(adapter->pnetdev, freq, ctype, 0);
+	#else
 	cfg80211_ch_switch_notify(adapter->pnetdev, freq, ctype);
+	#endif
 #endif
 
 exit:
@@ -5360,8 +5368,11 @@
 
 	return ret;
 }
-
+#if (LINUX_VERSION_CODE >= KERNEL_VERSION(5, 19, 2))
+static int cfg80211_rtw_stop_ap(struct wiphy *wiphy, struct net_device *ndev, unsigned int link_id)
+#else
 static int cfg80211_rtw_stop_ap(struct wiphy *wiphy, struct net_device *ndev)
+#endif
 {
 	_adapter *adapter = (_adapter *)rtw_netdev_priv(ndev);
 
@@ -6736,10 +6747,18 @@
 }
 
 #if (LINUX_VERSION_CODE >= KERNEL_VERSION(3, 8, 0))
+#if (LINUX_VERSION_CODE >= KERNEL_VERSION(5, 19, 2))
+static int cfg80211_rtw_get_channel(struct wiphy *wiphy,
+	struct wireless_dev *wdev,
+	unsigned int link_id,
+	struct cfg80211_chan_def *chandef)
+{
+#else
 static int cfg80211_rtw_get_channel(struct wiphy *wiphy,
 	struct wireless_dev *wdev,
 	struct cfg80211_chan_def *chandef)
 {
+#endif
 	_adapter *padapter = wiphy_to_adapter(wiphy);
 	struct mlme_ext_priv *mlmeext = &(padapter->mlmeextpriv);
 	u8 ht_option = 0;
@@ -10666,7 +10685,11 @@
 	rtw_cfg80211_indicate_scan_done(adapter, _TRUE);
 
 	#if (LINUX_VERSION_CODE >= KERNEL_VERSION(3, 11, 0)) || defined(COMPAT_KERNEL_RELEASE)
+	#if (LINUX_VERSION_CODE >= KERNEL_VERSION(5, 19, 2))
+	if (wdev->connected) {
+	#else
 	if (wdev->current_bss) {
+	#endif
 		RTW_INFO(FUNC_ADPT_FMT" clear current_bss by cfg80211_disconnected\n", FUNC_ADPT_ARG(adapter));
 		rtw_cfg80211_indicate_disconnect(adapter, 0, 1);
 	}
