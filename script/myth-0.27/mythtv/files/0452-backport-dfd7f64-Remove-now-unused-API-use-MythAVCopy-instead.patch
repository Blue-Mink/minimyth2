From dfd7f645128be917182a7246fed081b23772f969 Mon Sep 17 00:00:00 2001
From: Jean-Yves Avenard <jyavenard@mythtv.org>
Date: Tue, 1 Jul 2014 07:20:36 -0700
Subject: [PATCH 2/2] Remove now unused API, use MythAVCopy instead

---
 mythtv/libs/libmythtv/mythavutil.cpp |   53 ----------------------------------
 mythtv/libs/libmythtv/mythavutil.h   |   42 +++++++--------------------
 2 files changed, 10 insertions(+), 85 deletions(-)

diff --git a/mythtv/libs/libmythtv/mythavutil.cpp b/mythtv/libs/libmythtv/mythavutil.cpp
index d1645b7..7d2a939 100644
--- a/mythtv/libs/libmythtv/mythavutil.cpp
+++ b/mythtv/libs/libmythtv/mythavutil.cpp
@@ -68,59 +68,6 @@ int AVPictureFill(AVPicture *pic, const VideoFrame *frame, AVPixelFormat fmt)
     return (int)buffersize(frame->codec, frame->width, frame->height);
 }
 
-int AVPictureCopy(AVPicture *pic, const VideoFrame *frame,
-                  unsigned char *buffer, AVPixelFormat fmt)
-{
-    VideoFrameType type = PixelFormatToFrameType(fmt);
-    int size = buffersize(type, frame->width, frame->height, 0) + 16;
-    unsigned char *sbuf = buffer ? buffer : (unsigned char*)av_malloc(size);
-
-    if (!sbuf)
-    {
-        return 0;
-    }
-
-    avpicture_fill(pic, sbuf, fmt, frame->width, frame->height);
-    if ((type == FMT_YV12 || type == FMT_NV12) &&
-        (frame->codec == FMT_NV12 || frame->codec == FMT_YV12))
-    {
-        copybuffer(sbuf, frame, pic->linesize[0], type);
-    }
-    else
-    {
-        AVPixelFormat fmt_in = FrameTypeToPixelFormat(frame->codec);
-        AVPicture img_in;
-        AVPictureFill(&img_in, frame);
-        MythAVCopy copy;
-        copy.Copy(pic, fmt, &img_in, fmt_in, frame->width, frame->height);
-    }
-
-    return size;
-}
-
-int AVPictureCopy(VideoFrame *frame, const AVPicture *pic, AVPixelFormat fmt)
-{
-    VideoFrameType type = PixelFormatToFrameType(fmt);
-    int size = buffersize(type, frame->width, frame->height, 0) + 16;
-    unsigned char *sbuf = (unsigned char*)av_malloc(size);
-
-    if ((type == FMT_YV12 || type == FMT_NV12) &&
-        (frame->codec == FMT_NV12 || frame->codec == FMT_YV12))
-    {
-        copybuffer(sbuf, frame, pic->linesize[0], type);
-    }
-    else
-    {
-        // Can't handle those natively, convert it first
-        AVPixelFormat fmt_out = FrameTypeToPixelFormat(frame->codec);
-        AVPicture img_out;
-        AVPictureFill(&img_out, frame);
-        MythAVCopy copy;
-        copy.Copy(&img_out, fmt_out, pic, fmt, frame->width, frame->height);
-    }
-    return frame->size;
-}
-
 class MythAVCopyPrivate
 {
 public:
diff --git a/mythtv/libs/libmythtv/mythavutil.h b/mythtv/libs/libmythtv/mythavutil.h
index de018b6..0891fd1 100644
--- a/mythtv/libs/libmythtv/mythavutil.h
+++ b/mythtv/libs/libmythtv/mythavutil.h
@@ -65,42 +65,12 @@ private:
 };
 
 typedef struct VideoFrame_ VideoFrame;
-
-/**
- * AVPictureFill
- * Initialise AVPicture pic with content from VideoFrame frame
- */
-int MTV_PUBLIC AVPictureFill(AVPicture *pic, const VideoFrame *frame,
-                             AVPixelFormat fmt = AV_PIX_FMT_NONE);
-
-/**
- * AVPictureCopy
- * Initialise AVPicture pic, create buffer if required and copy content of
- * VideoFrame frame into it, performing the required conversion if any
- * Returns size of buffer allocated
- * Data would have to be deleted once finished with object with:
- * av_freep(pic->data[0])
- */
-int MTV_PUBLIC AVPictureCopy(AVPicture *pic, const VideoFrame *frame,
-                             unsigned char *buffer = NULL,
-                             AVPixelFormat fmt = AV_PIX_FMT_YUV420P);
-
-/**
- * AVPictureCopy
- * Copy AVPicture pic into VideoFrame frame, performing the required conversion
- * Returns size of frame data
- */
-int MTV_PUBLIC AVPictureCopy(VideoFrame *frame, const AVPicture *pic,
-                             AVPixelFormat fmt = AV_PIX_FMT_YUV420P);
-
 class MythAVCopyPrivate;
 
 /**
- * AVCopy
- * Copy picture/frame pic, performing the required conversion
- * Returns size of frame data
+ * MythAVCopy
+ * Copy AVPicture<->frame, performing the required conversion if any
  */
-
 class MTV_PUBLIC MythAVCopy
 {
 public:
@@ -135,4 +105,12 @@ private:
                    int width, int height, AVPixelFormat pix_fmt);
     MythAVCopyPrivate *d;
 };
+
+/**
+ * AVPictureFill
+ * Initialise AVPicture pic with content from VideoFrame frame
+ */
+int MTV_PUBLIC AVPictureFill(AVPicture *pic, const VideoFrame *frame,
+                             AVPixelFormat fmt = AV_PIX_FMT_NONE);
+
 #endif
-- 
1.7.10.2

