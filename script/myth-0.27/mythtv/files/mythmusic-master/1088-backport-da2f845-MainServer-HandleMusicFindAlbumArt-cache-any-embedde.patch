From da2f8455465f40e3accfe8acd81ee14028fe885e Mon Sep 17 00:00:00 2001
From: Paul Harrison <pharrison@mythtv.org>
Date: Tue, 11 Mar 2014 09:26:12 +0000
Subject: [PATCH 07/13] MainServer::HandleMusicFindAlbumArt: cache any
 embedded images found

---
 mythtv/programs/mythbackend/mainserver.cpp |   14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/mythtv/programs/mythbackend/mainserver.cpp b/mythtv/programs/mythbackend/mainserver.cpp
index 509415b..be11bed 100644
--- a/mythtv/programs/mythbackend/mainserver.cpp
+++ b/mythtv/programs/mythbackend/mainserver.cpp
@@ -5659,6 +5659,20 @@ void MainServer::HandleMusicFindAlbumArt(const QStringList &slist, PlaybackSock
             strlist.append(image->description);
             strlist.append(image->filename);
             strlist.append(image->hostname);
+
+            // if this is an embedded image update the cached image
+            if (image->embedded)
+            {
+                QStringList paramList;
+                paramList.append(QString("--songid='%1'").arg(mdata->ID()));
+                paramList.append(QString("--imagetype='%1'").arg(image->imageType));
+
+                QString command = "mythutil --extractimage " + paramList.join(" ");
+                QScopedPointer<MythSystem> cmd(MythSystem::Create(command,
+                                                    kMSAutoCleanup | kMSRunBackground |
+                                                    kMSDontDisableDrawing | kMSProcessEvents |
+                                                    kMSDontBlockInputDevs));
+            }
         }
     }
 
-- 
1.7.10.2

