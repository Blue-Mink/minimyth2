From a9e332ef8cc858020e0ab8bd670e6353cf798b5d Mon Sep 17 00:00:00 2001
From: Paul Harrison <pharrison@mythtv.org>
Date: Sun, 16 Feb 2014 22:24:46 +0000
Subject: [PATCH 3/6] findIcon: add option to ignore the cached filename

---
 mythtv/libs/libmythmetadata/musicutils.cpp |   11 +++++++----
 mythtv/libs/libmythmetadata/musicutils.h   |    2 +-
 2 files changed, 8 insertions(+), 5 deletions(-)

diff --git a/mythtv/libs/libmythmetadata/musicutils.cpp b/mythtv/libs/libmythmetadata/musicutils.cpp
index e0cca3f..f8e8df6 100644
--- a/mythtv/libs/libmythmetadata/musicutils.cpp
+++ b/mythtv/libs/libmythmetadata/musicutils.cpp
@@ -31,11 +31,14 @@ QString fixFilename(const QString &filename)
 }
 
 static QMap<QString, QString> iconMap;
-QString findIcon(const QString &type, const QString &name)
+QString findIcon(const QString &type, const QString &name, bool ignoreCache)
 {
-    QMap<QString, QString>::iterator i = iconMap.find(type + name);
-    if (i != iconMap.end())
-        return i.value();
+    if (!ignoreCache)
+    {
+        QMap<QString, QString>::iterator i = iconMap.find(type + name);
+        if (i != iconMap.end())
+            return i.value();
+    }
 
     QString cleanName = fixFilename(name);
     QString file = QString("Icons/%1/%2").arg(type).arg(cleanName);
diff --git a/mythtv/libs/libmythmetadata/musicutils.h b/mythtv/libs/libmythmetadata/musicutils.h
index a9d14f3..fb2bb2f 100644
--- a/mythtv/libs/libmythmetadata/musicutils.h
+++ b/mythtv/libs/libmythmetadata/musicutils.h
@@ -16,7 +16,7 @@ class MusicMetadata;
 META_PUBLIC QString fixFilename(const QString &filename);
 
 /// find an image for a artist or genre
-META_PUBLIC QString findIcon(const QString &type, const QString &name);
+META_PUBLIC QString findIcon(const QString &type, const QString &name, bool ignoreCache = false);
 
 /// calculate a tracks length by parsing the frames
 META_PUBLIC uint calcTrackLength(const QString &musicFile);
-- 
1.7.10

