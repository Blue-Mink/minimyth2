From 798db05be600d0f89100f68e32794c0a5d6b982b Mon Sep 17 00:00:00 2001
From: Paul Harrison <pharrison@mythtv.org>
Date: Sun, 9 Feb 2014 17:52:57 +0000
Subject: [PATCH 3/8] MythMusic: fix saving the metadata to the tag on the
 editmetadata screen

---
 mythplugins/mythmusic/mythmusic/editmetadata.cpp |   17 +++++++++--------
 1 file changed, 9 insertions(+), 8 deletions(-)

diff --git a/mythplugins/mythmusic/mythmusic/editmetadata.cpp b/mythplugins/mythmusic/mythmusic/editmetadata.cpp
index b8a0fd4..6fb6012 100644
--- a/mythplugins/mythmusic/mythmusic/editmetadata.cpp
+++ b/mythplugins/mythmusic/mythmusic/editmetadata.cpp
@@ -200,19 +200,20 @@ void EditMetadataCommon::saveToDatabase()
 
 void EditMetadataCommon::saveAll()
 {
+    saveToDatabase();
+
+    // only write to the tag if it's enabled by the user
     if (GetMythDB()->GetNumSetting("AllowTagWriting", 0))
     {
-        MetaIO *tagger = m_metadata->getTagger();
+        QStringList strList;
+        strList << QString("MUSIC_TAG_UPDATE_METADATA %1 %2")
+                            .arg(m_metadata->Hostname())
+                            .arg(m_metadata->ID());
 
-        if (tagger)
-        {
-            tagger->write(m_metadata->Filename(), m_metadata);
-            delete tagger;
-        }
+        SendStringListThread *thread = new SendStringListThread(strList);
+        MThreadPool::globalInstance()->start(thread, "UpdateMetadata");
     }
 
-    saveToDatabase();
-
     cleanupAndClose();
 }
 
-- 
1.7.10

