From 1011c6118d92ef655cef826710ecd5fecbcb53b6 Mon Sep 17 00:00:00 2001
From: Paul Harrison <pharrison@mythtv.org>
Date: Thu, 13 Feb 2014 21:14:35 +0000
Subject: [PATCH 2/4] MusicImport: fix switching of the metadata editor to
 metadata only mode

---
 mythplugins/mythmusic/mythmusic/editmetadata.cpp |    5 ++++-
 mythplugins/mythmusic/mythmusic/importmusic.cpp  |    3 ++-
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/mythplugins/mythmusic/mythmusic/editmetadata.cpp b/mythplugins/mythmusic/mythmusic/editmetadata.cpp
index 6fb6012..0c6b2e0 100644
--- a/mythplugins/mythmusic/mythmusic/editmetadata.cpp
+++ b/mythplugins/mythmusic/mythmusic/editmetadata.cpp
@@ -221,7 +221,7 @@ void EditMetadataCommon::setSaveMetadataOnly(void)
 {
     metadataOnly = true;
 
-    MythUIButton *albumartButton = dynamic_cast<MythUIButton *>(GetChild("albumart_button"));
+    MythUIButton *albumartButton = dynamic_cast<MythUIButton *>(GetChild("albumartbutton"));
     if (albumartButton)
         albumartButton->Hide();
 }
@@ -508,6 +508,9 @@ bool EditMetadataDialog::keyPressEvent(QKeyEvent *event)
 
 void EditMetadataDialog::showMenu(void )
 {
+    if (metadataOnly)
+        return;
+
     QString label = tr("Options");
 
     MythScreenStack *popupStack = GetMythMainWindow()->GetStack("popup stack");
diff --git a/mythplugins/mythmusic/mythmusic/importmusic.cpp b/mythplugins/mythmusic/mythmusic/importmusic.cpp
index 474ee5f..a166c78 100644
--- a/mythplugins/mythmusic/mythmusic/importmusic.cpp
+++ b/mythplugins/mythmusic/mythmusic/importmusic.cpp
@@ -647,7 +647,6 @@ void ImportMusicDialog::showEditMetadataDialog()
     MythScreenStack *mainStack = GetMythMainWindow()->GetMainStack();
 
     EditMetadataDialog *editDialog = new EditMetadataDialog(mainStack, editMeta);
-    editDialog->setSaveMetadataOnly();
 
     if (!editDialog->Create())
     {
@@ -655,6 +654,8 @@ void ImportMusicDialog::showEditMetadataDialog()
         return;
     }
 
+    editDialog->setSaveMetadataOnly();
+
     connect(editDialog, SIGNAL(metadataChanged()), this, SLOT(metadataChanged()));
 
     mainStack->AddScreen(editDialog);
-- 
1.7.10.2

