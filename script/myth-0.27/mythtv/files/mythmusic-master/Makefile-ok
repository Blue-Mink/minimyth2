GARNAME = mythtv
GARVERSION = $(MYTHTV_VERSION)
CATEGORIES = $(CATEGORY)
MASTER_SITES = svn://svn.mythtv.org/svn/trunk/
DISTFILES = $(DISTNAME).tar.bz2
PATCHFILES  =

# Backend needed patches
PATCHFILES += 0001-ticket2416_copy_eit_2_other_source.patch
PATCHFILES += 0002-ticket9480_pl_eit_encodings.patch
PATCHFILES += 0003-delay_4_no_concurent_start_rec.patch
PATCHFILES += 0004-eit_verbosity.patch
PATCHFILES += 0005-tid_debug_verbosity.patch
PATCHFILES += 0007-cardutil_show_displayname.patch
PATCHFILES += 0009-allow_no_tuners.patch
PATCHFILES += 0010-ticket10136_DBerrors_on_overlaping_EIT.patch
PATCHFILES += 0011-ticket9726-Unicable_SCR_DIN_EN_50494-v6.patch
PATCHFILES += 0012-dont_send_diseq_if_tuning_to_the_same_transponder.patch
PATCHFILES += 0013-reset_diseqc_bus_only_once_v4.patch
PATCHFILES += 0014-SCR_keep_disecq_always_18V.patch
PATCHFILES += 0015-resend_disecq_cmds.patch
PATCHFILES += 0019-add_verbose_dvb_lock_info.patch
PATCHFILES += 0021-make_EIT_start_at_time.patch
PATCHFILES += 0022-mythutil-add-an-option-to-check-recordings.patch
PATCHFILES += 0023-delay-concurent-tunings.patch
PATCHFILES += 0024-disable_break_when_no_PES_PUSI_set.patch

# Minimyth needed patches
# PATCHFILES += 0100-zeromq_cross.patch.gar
PATCHFILES += 0100-minimyth.patch
PATCHFILES += 0101-programid.patch
PATCHFILES += 0102-maintain_menu.patch
PATCHFILES += 0103-minimyth-defaults.patch 

# Frontend patches
PATCHFILES += 0200-ticket9633_progressbar_on_osd.patch
PATCHFILES += 0202-_LMSC_osd.patch
PATCHFILES += 0203-udisks_timeout.patch
PATCHFILES += 0204-netvision_build.patch
PATCHFILES += 0205-mythmusic_quick_browsing.patch
PATCHFILES += 0206-python_bindings_tztime_error.patch
PATCHFILES += 0207-ticket10999_fix_white_screen_mythgallery.patch
PATCHFILES += 0208-add-mythnotification-custom-styles-support-via-UDP.patch
PATCHFILES += 0218-backport-c0c5299-Allow-Live-TV-to-be-entered-from-the-top-level-Progr.patch
PATCHFILES += 0219-backport-e3ee97c-Be-more-flexible-about-starting-the-Guide-at-a-parti.patch
PATCHFILES += 0220-backport-eb13dd5-Allow-the-Guide-start-channel-to-be-the-natural-Live.patch
PATCHFILES += 0221-backport-7fd5ad1-Update-cardinput.startchan-upon-successful-Live-TV-t.patch
PATCHFILES += 0222-backport-77ddcc1-Prefer-the-DefaultChanid-setting-when-picking-EPG-ch.patch
PATCHFILES += 0223-backport-98c9088-Add-tunability-tests-to-the-Watch-This-Channel-menu-.patch
PATCHFILES += 0224-add-osd-status-notify-to-mythmediacenter.patch
PATCHFILES += 0225-ticket11983.patch
PATCHFILES += 0229-add-disable-optical-disc-by-mm-config.patch
PATCHFILES += 0230-backport-93fdda5-MythMusic-re-factor-Playlist-to-avoid-storing-MusicM.patch
PATCHFILES += 0231-fix-zoneminder-1.26.5.patch
PATCHFILES += 0232-mythmusic_ticket10710_play_tracks_from_edit_trebors.patch
PATCHFILES += 0233-backport-70143d3-Allow-bookmarks-when-reading-DVDs-from-directories-i.patch
PATCHFILES += 0248-backport-2874f0d-Sync-libdvdread-up-to-R1290.patch
PATCHFILES += 0249-backport-2a6038b-Sync-libdvdnav-up-to-R1294.patch
PATCHFILES += 0251-backport-cd452cf-Minor-re-work-of-DVD-serialization-code-to-match-cod.patch
PATCHFILES += 0252-backport-b57cf4b-RemoteFile-add-a-static-FindFile-function-to-find-a-.patch
PATCHFILES += 0253-mythlink-pretty-with-recgroup-subdir.patch
PATCHFILES += 0254-backport-1f3fb4a-Removed-custom-dvdnav_first_play-function-from-libdv.patch
PATCHFILES += 0255-backport-137b8d7-Additional-files-missing-from-1f3fb4a61e.patch
PATCHFILES += 0258-backport-1e97539-Ensure-programflags-is-initialised.-ProgramInfo-Load.patch
PATCHFILES += 0259-ticket12055-hls-add-preset-tune.patch
PATCHFILES += 0260-ticket12047-mythplayer-picks-the-wrong-fps-for-1080i-matroska.patch
PATCHFILES += 0261-ticket12049-the-year-of-a-video-can-not-be-displayed-in-the-OSD-program-info.patch
PATCHFILES += 0263-backport-588c95d-HLS-Don-t-allow-duplicate-streams-to-be-created.patch
PATCHFILES += 0264-backport-a9b8a86-HLS-Add-the-EXT-X-MEDIA-tags-to-the-Master-Playlist.patch
PATCHFILES += 0266-speedup-playback-start.patch
PATCHFILES += 0271-ticket11119.patch
PATCHFILES += 0274-backport-7c7d800-HLS-Don-t-scale-video-beyond-it-s-original-resolutio.patch
PATCHFILES += 0275-backport-847dce4-Transcoder-Remove-assumption-that-all-1080-video-is-.patch
PATCHFILES += 0276-backport-7133fc4-HLS-Enable-deinterlacing-for-HLS.-Web-videos-must-be.patch
PATCHFILES += 0277-backport-1012ad3-HLS-Fix-audio-only-bitrate-to-64k-per-Apple-recommen.patch
PATCHFILES += 0278-backport-2c71895-HLS-Decrease-segment-size-from-10-to-4-seconds-which.patch
PATCHFILES += 0279-backport-103d573-Fixes-null-dereference.patch
PATCHFILES += 0295-backport-b0aa4e5-Allow-capture-of-the-unprocessed-raw-MPTS-from-appro.patch
PATCHFILES += 0306-ticket10878-mythplayer-Don-t-call-DoneDisplayingFrame-for-PiP.patch
PATCHFILES += 0307-backport-95652b6-EIT-improvements-for-DVB.patch
PATCHFILES += 0308-backport-619b008-simplify-handling-of-missing-endtime-at-end-of-file-.patch
PATCHFILES += 0309-backport-7fd0a20-Fix-some-confusion-over-the-behaviour-purpose-of-IsS.patch
PATCHFILES += 0310-backport-0db22a0-Use-QEventLoop-for-modal-windows.patch
PATCHFILES += 0311-backport-cd80b1c-protect-metadata-loads-from-multiple-threads.patch
PATCHFILES += 0312-backport-3771b88-Fix-random-SBE-PlaybackSock-timeout-in-MBE.patch
PATCHFILES += 0313-backport-636ca29-Reduce-CPU-usage-while-waiting-for-seek-to-complete.patch

# first set of patches for LiveTV
PATCHFILES += 0581-backport-ed52e84-Small-optimisation-of-FileRingBuffer-GetRealFileSize.patch
PATCHFILES += 0582-backport-c24e2e7-Fix-seek-when-close-to-end-of-program.patch

# second set of patches for LiveTV
PATCHFILES += 0583-backport-cad3f0a-Do-not-abort-early-if-not-all-data-is-received-withi.patch
PATCHFILES += 0584-backport-5f47d69-Add-QUERY_FILETRANSFER-REQUEST_SIZE-command.patch
PATCHFILES += 0585-backport-6290fd9-Add-RemoteFile-GetRealFileSize.patch
PATCHFILES += 0586-backport-5d82ba6-Fix-seek-when-close-to-end-of-program-2.patch
PATCHFILES += 0587-backport-c64141b-Fix-calculation-of-read-block-size.patch
PATCHFILES += 0588-backport-2980b3d-Return-the-actual-file-size-rather-than-the-one-when.patch
PATCHFILES += 0589-backport-9883b43-Only-expire-LiveTV-programs-that-are-less-than-30s-a.patch

# third patches for LiveTV
PATCHFILES += 0590-backport-dddf14c-Partial-revert-of-c64141b0c0b7118ee28be2441374727a1a.patch
PATCHFILES += 0591-backport-8c17413-Cache-the-size-of-the-remote-file-for-500ms.patch
PATCHFILES += 0592-backport-1da2a0e-Set-initial-FileRingBuffer-rawbitrate-to-800.patch
PATCHFILES += 0593-backport-1ff446a-RingBuffer-Play-encrypted-dvd-s-and-iso-images-from-.patch

# backports from master when jya backport devel/ringbuffer to master
PATCHFILES += 0608-backport-c519bba-Add-ReadInternalMode-to-RingBuffer-class.patch
PATCHFILES += 0609-backport-e469043-Try-to-open-the-media-for-1.5s-using-only-the-intern.patch

PATCHFILES += 0314-backport-ad1361a-Allows-RemoteFile-to-recover-from-connection-drop-or.patch
PATCHFILES += 0315-backport-305b409-Reset-failures-count-once-a-read-succeed.patch
PATCHFILES += 0316-backport-b87d476-Have-RemoteFile-attempt-to-fully-reconnect-in-case-o.patch
PATCHFILES += 0317-backport-4bb7059-Prevent-crash-should-playback-fail-after-ringbuffer-.patch
PATCHFILES += 0318-backport-904b65b-Don-t-prevent-read-should-we-reached-EOF-or-an-error.patch
PATCHFILES += 0319-backport-e8fa11c-Pause-playback-rather-than-exiting-should-backend-st.patch
PATCHFILES += 0320-backport-07eff1b-MythFrontend-Make-Xlib-calls-thread-safe-on-Linux.patch
PATCHFILES += 0321-backport-8877719-Fix-probable-cut-n-paste-error.-VB_PLAYBACK-should-b.patch
PATCHFILES += 0322-backport-fa75762-change-default-duplicate-detection-method-to-subtitl.patch
PATCHFILES += 0323-backport-dbb3874-Fix-stuttery-playback-for-FFmpeg-s-directly-rendered.patch
PATCHFILES += 0324-backport-2f1b223-ffmpeg-backport-register-vdpau-hwaccel-for-mpeg12.patch
PATCHFILES += 0325-backport-013ac54-Fixes-12128.patch
PATCHFILES += 0326-backport-a5b996c-Migrate-vdpau-decoding-to-FFmpeg-s-new-hwaccel-API.patch
PATCHFILES += 0327-backport-8f0437c-Fix-playback-of-9-10bit-h264-videos.patch
PATCHFILES += 0328-backport-7d6471d-vdpau-Fix-VC-1-interlaced-mode.patch

#test := $(shell cat ~/.minimyth/minimyth.conf.mk | grep "^mm_VERSION_MINIMYTH\s*?=" | sed -e "s/\s*//g")
#$(info $$test is '${test}')

ifeq ($(patsubst %private,private,$(shell cat ~/.minimyth/minimyth.conf.mk | grep "^mm_VERSION_MINIMYTH\s*?=" | sed -e "s/\s*//g")),private)

    PATCHFILES += 1000-backport-ce58f2b-MythMusic-move-the-music-file-scanner-into-libmythme.patch
    PATCHFILES += 1001-backport-f6d85da-MythUtil-add-an-updatemeta-option-to-update-music-ta.patch
    PATCHFILES += 1002-backport-0f987f3-MythMusic-only-send-track-added-removed-events-for-t.patch
    PATCHFILES += 1003-backport-532b67d-MythMusic-start-decoupling-the-file-scanning-from-th.patch
    PATCHFILES += 1004-backport-b614fac-MythUtil-add-a-scanmusic-option-to-start-a-scan-for-.patch
    PATCHFILES += 1005-backport-63b6f37-MusicPlayer-show-some-notifications-showing-the-file.patch
    PATCHFILES += 1006-backport-c71f06b-MythMusic-move-loadMusic-to-MusicData.patch
    PATCHFILES += 1007-backport-c2835a6-MythMusic-check-all-tracks-in-a-playlist-are-still-v.patch
    PATCHFILES += 1008-backport-7ccbcb2-MusicMetadata-remove-unused-function.patch
    PATCHFILES += 1009-backport-5acb781-MythMusic-add-support-for-embedded-images-in-flac-xi.patch
    PATCHFILES += 1010-backport-835791b-MythMusic-preserve-the-modified-timestamp-after-upda.patch
    PATCHFILES += 1011-backport-d5cf173-MythMusic-make-sure-the-memory-cache-is-updated-afte.patch
    PATCHFILES += 1012-backport-8ed610f-MythMusic-add-Music-and-MusicArt-to-the-special-stor.patch
    PATCHFILES += 1013-backport-8aefe1b-Add-a-SCAN_MUSIC-command-to-the-myth-protocol.patch
    PATCHFILES += 1014-backport-b1b6f14-MythMusic-update-the-file-scanner-to-scan-a-list-dir.patch
    PATCHFILES += 1014-backport-dfd97aa0-Fix-inadvertent-double-scaling-of-images.-Some-break.patch
    PATCHFILES += 1015-backport-52fa7ecc-In-MythImage-Load-don-t-treat-a-failed-image-load-as.patch
    PATCHFILES += 1016-backport-b0f5ccc-MusicMetadata-cache-the-actual-URL-of-the-file-when-.patch
    PATCHFILES += 1017-backport-83a3e28-MythMusic-add-a-hostname-column-to-the-music_songs-t.patch
    PATCHFILES += 1018-backport-df6b8a7-MusicMetadata-fix-updating-the-hostname-if-different.patch
    PATCHFILES += 1019-backport-7b9d369-MusicMetadata-add-missing-comma-to-database-update-q.patch
    PATCHFILES += 1020-backport-d6cb32f-RemoteFile-handle-the-slave-unreachable-case-in-Find.patch
    PATCHFILES += 1021-backport-64bbf10-MythMusic-add-a-hostname-column-to-the-music_albumar.patch
    PATCHFILES += 1022-backport-0de9f67-MythMusic-add-support-to-the-file-scanner-for-music-.patch
    PATCHFILES += 1023-backport-6c70cd1-MainServer-update-the-SCAN_MUSIC-command-to-also-sca.patch
    PATCHFILES += 1024-backport-dafa8d2-MythMusic-show-separate-file-scanner-status-notifica.patch
    PATCHFILES += 1025-backport-2bbf5e1-MusicFileScanner-fix-updating-modified-tracks.patch
    PATCHFILES += 1026-backport-97ae3f5-MythUtil-add-extractimage-command.patch
    PATCHFILES += 1027-backport-e6c8a78-MainServer-add-a-MUSIC_TAG_GETIMAGE-command-to-the-m.patch
    PATCHFILES += 1028-backport-92229a0-MythImage-fix-loading-images-from-slave-BE-s.patch
    PATCHFILES += 1029-backport-5f88a66-AlbumArtImages-load-the-hostname-from-the-database.patch
    PATCHFILES += 1030-backport-d632130-MythMusic-switch-the-filescanner-to-scan-the-Music-s.patch
    PATCHFILES += 1031-backport-5369643-MythMusic-send-a-SCAN_MUSIC-command-to-the-master-BE.patch
    PATCHFILES += 1032-backport-5163592-RemoteFile-add-a-CopyFile-static-function.patch
    PATCHFILES += 1033-backport-bb32a29-RemoteFile-CopyFile-check-we-re-not-trying-to-copy-a.patch
    PATCHFILES += 1034-backport-1c5b5e1-ImportMusic-update-the-music-import-to-use-storage-g.patch
    PATCHFILES += 1035-backport-94fe080-MythMusic-remove-Directory-to-hold-music-setting-fro.patch
    PATCHFILES += 1035-backport-b53ba13-MythMusic-check-we-have-at-least-one-directory-in-th.patch
    PATCHFILES += 1036-backport-019d4c9-MusicMetadata-remove-some-no-longer-required-local-f.patch
    PATCHFILES += 1037-backport-504fac8-MusicPlayer-no-need-to-update-the-music-directory-wh.patch
    PATCHFILES += 1038-backport-a5ecdd0-MythMusic-remove-no-longer-required-get-setMusicDire.patch
    PATCHFILES += 1039-backport-8faecfd-MythMusic-remove-the-local-file-access-from-findIcon.patch
    PATCHFILES += 1040-backport-32527e2-MythMusic-update-retrieving-album-art-to-use-storage.patch
    PATCHFILES += 1041-backport-a0b194d-AlbumArtImages-make-sure-the-hostname-is-saved-to-th.patch
    PATCHFILES += 1042-backport-4920da1-MythMusic-check-we-have-found-some-tracks-before-sho.patch
    PATCHFILES += 1043-backport-11c6a6e-MetaIO-Update-the-hostname-when-creating-an-AlbumArt.patch
    PATCHFILES += 1044-backport-efc60a4-MusicAlbumArt-more-hostname-fixes-and-fix-the-file-n.patch
    PATCHFILES += 1045-backport-61b91c9-Remove-some-debugging.patch
    PATCHFILES += 1046-backport-94ee5e6-RemoteFile-Copy-fix-the-really-poor-performance.patch
    PATCHFILES += 1047-backport-f36c44f-MythMusic-delete-any-unused-directory_ids-from-music.patch
    PATCHFILES += 1048-backport-d8e6512-MythMusic-update-the-music-cd-ripper-to-use-storage-.patch
    PATCHFILES += 1049-backport-1238ba4-MetaIO-Add-the-filename-to-write-and-writeVolatileMe.patch
    PATCHFILES += 1050-backport-92d1750-MusicMetadata-add-the-missing-FileSize-implementatio.patch
    PATCHFILES += 1051-backport-c83121a-MusicMetadata-add-a-getLocalFilename-function.patch
    PATCHFILES += 1052-backport-9864bfa-MusicMetadata-clear-the-cached-actual-filename-when-.patch
    PATCHFILES += 1053-backport-101b07e-Missed-a-file-in-1238ba43bcf.patch
    PATCHFILES += 1054-backport-f20b9ca-CDRipper-fix-the-writing-of-the-metadata-to-the-tag.patch
    PATCHFILES += 1055-backport-2f1a535-Myth-Protocol-add-a-MUSIC_TAG_UPDATE_VOLATILE-comman.patch
    PATCHFILES += 1056-backport-3b212b5-MusicPlayer-use-the-myth-protocol-to-update-the-vola.patch
    PATCHFILES += 1057-backport-d921746-Myth-Protocol-add-a-MUSIC_TAG_UPDATE_METADATA-comman.patch
    PATCHFILES += 1058-backport-4d33752-MythMusic-don-t-send-SCAN_MUSIC-and-MUSIC_TAG_UPDATE.patch
    PATCHFILES += 1059-backport-798db05-MythMusic-fix-saving-the-metadata-to-the-tag-on-the-.patch
    PATCHFILES += 1060-backport-7fec2d4-MusicMetadata-make-sure-the-various-get-Id-functions.patch
    PATCHFILES += 1061-backport-b351859-AlbumArtImages-add-option-to-not-load-images-from-th.patch
    PATCHFILES += 1062-backport-d018509-Myth-Protocol-add-a-MUSIC_FIND_ALBUMART-command.patch
    PATCHFILES += 1063-backport-74227e3-AlbumArtImages-add-a-scanForImages-function.patch
    PATCHFILES += 1064-backport-1011c61-MusicImport-fix-switching-of-the-metadata-editor-to-.patch
    PATCHFILES += 1065-backport-faea970-MusicImport-update-the-importing-of-albumart-to-work.patch
    PATCHFILES += 1066-backport-5b18f41-MythMusic-start-updating-the-edit-metadata-screen-to.patch
    PATCHFILES += 1067-backport-5cedac9-HandleMusicFindAlbumArt-only-save-the-filename-not-t.patch
    PATCHFILES += 1068-backport-a9e332e-findIcon-add-option-to-ignore-the-cached-filename.patch
    PATCHFILES += 1069-backport-af9c269-EditMetadata-update-the-internet-image-search-to-wor.patch
    PATCHFILES += 1070-backport-98c3f59-MythUtil-add-a-calctracklen-option.patch
    PATCHFILES += 1071-backport-b257f3c-Myth-Protocol-add-a-MUSIC_CALC_TRACK_LENGTH-command.patch
    PATCHFILES += 1072-backport-0a755c7-MythMusic-fix-the-Check-Track-Length-option-on-the-e.patch
    PATCHFILES += 1073-backport-fe65b3a-MythMusic-remove-the-redundant-calcTrackLength-from-.patch
    PATCHFILES += 1074-backport-4d59ee4-MusicMetadata-Filename-return-an-invalid-filename-if.patch
    PATCHFILES += 1075-backport-424bb16-MythMusic-improve-the-handling-of-unavailable-tracks.patch
    PATCHFILES += 1076-backport-abd9204-MusicCommon-handle-TrackUnavailableEvents-from-the-m.patch
    PATCHFILES += 1077-backport-ff91ef5-MythCenter-wide-Add-the-unavailable-state-to-the-pla.patch
    PATCHFILES += 1078-backport-1847980-default-themes-Add-the-unavailable-state-to-the-play.patch
    PATCHFILES += 1079-backport-576b2d7-MythCenter-wide-tweak-the-position-of-the-unavailabl.patch
    PATCHFILES += 1080-backport-ad113b1-AlbumArtImages-update-the-id-after-dumping-to-the-da.patch
    PATCHFILES += 1081-backport-4fe3cbc-AlbumArtImages-add-a-function-to-retrieve-an-image-b.patch
    PATCHFILES += 1082-backport-f64b513-MythMusic-Allow-a-different-resume-mode-to-be-set-fo.patch
    PATCHFILES += 1083-backport-2e009ed-MythMusic-fix-playback-from-CD-only-playing-the-firs.patch
    PATCHFILES += 1084-backport-e350c8f-myth-protocol-add-a-MUSIC_TAG_ADDIMAGE-command.patch
    PATCHFILES += 1085-backport-b9d40e4-myth-protocol-add-a-MUSIC_TAG_REMOVEIMAGE-command.patch
    PATCHFILES += 1086-backport-d702b20-myth-protocol-fix-copy-paste-error-in-the-MUSIC_TAG_.patch
    PATCHFILES += 1087-backport-c889cbd-mythutil-ExtractImage-Always-update-the-image-even-i.patch
    PATCHFILES += 1088-backport-da2f845-MainServer-HandleMusicFindAlbumArt-cache-any-embedde.patch
    PATCHFILES += 1089-backport-763d003-MainServer-HandleMusicTagGetImage-pass-the-ImageType.patch
    PATCHFILES += 1090-backport-fd54a60-AlbumArtImages-scanForImages-fix-the-image-filename.patch
    PATCHFILES += 1091-backport-96bf5c6-MythMusic-update-the-metadata-editor-adding-removing.patch
    PATCHFILES += 1092-backport-cffec7f-MusicMetadata-copy-m_actualFilename-in-operator.patch
    PATCHFILES += 1093-backport-5569a37-AlbumArtImages-use-the-filename-as-is-for-non-myth-u.patch
    PATCHFILES += 1094-backport-efafb14-myth-protocol-add-a-MUSIC_TAG_CHANGEIMAGE-command.patch
    PATCHFILES += 1095-backport-b4c0652-MythMusic-re-enable-the-change-image-type-option-in-.patch
    PATCHFILES += 1096-backport-b9bbe36-myth-protocol-MUSIC_TAG_UPDATE_VOLATILE-pass-the-par.patch
    PATCHFILES += 1097-backport-0706ec1-myth-protocol-MUSIC_-commands-pass-the-parameters-on.patch
    PATCHFILES += 1098-backport-1153fae-Silence-a-couple-of-compiler-warnings.patch
    PATCHFILES += 1099-backport-ad53f11-MusicMetadata-fix-missing-parameter-when-sending-MUS.patch
    PATCHFILES += 1100-backport-abc3a32-Check-we-found-the-notification-image.-Fixes-Coverit.patch
    PATCHFILES += 1101-backport-ab2ab7d-PlayerSettings-Fix-Uninitialized-pointer-fields.-Fix.patch
    PATCHFILES += 1102-backport-0787da3-AlbumArtImage-Fix-leak-in-findImages.-Fixes-Coverity.patch
    PATCHFILES += 1103-backport-35b4134-MainServer-Fix-leak-in-HandleMusicFindAlbumArt.-Fixe.patch
    PATCHFILES += 1104-backport-d84e590-Fix-leak-in-ScanMusic-if-no-directories-found.-Fixes.patch
#    PATCHFILES += 1105-backport-3ee65b3-Update-the-myth-protocol-version-after-the-addition-.patch
    PATCHFILES += 1106-backport-dcd88dd-PlaylistEditorView-null-check-the-playlist-in-getPla.patch
    PATCHFILES += 1107-backport-3a0b515-MetaIO-clear-the-m_fileinfo-struct-in-the-ctor-to-ke.patch
    PATCHFILES += 1108-backport-c82bb00-MusicFileScanner-initialise-some-member-variables-in.patch
    PATCHFILES += 1109-backport-98eda1b-MythSingleDownload-initialise-m_errorcode-in-the-cto.patch
    PATCHFILES += 1110-backport-e715deb-findIcon-use-RemoteFile-FindFile-to-search-for-the-i.patch
    PATCHFILES += 1111-backport-c5e7269-getAlbumArtFile-add-a-sanity-check-before-searching-.patch
    PATCHFILES += 1112-backport-87c064d-PlaylistEditorView-make-sure-we-only-update-the-imag.patch
    PATCHFILES += 1113-backport-264694f-PlaylistEditorView-don-t-bother-looking-for-an-icon-.patch
    PATCHFILES += 1114-backport-41580eb-Myth-Protocol-add-optional-allowFallback-parameter-t.patch
    PATCHFILES += 1115-backport-d7ad84a-RemoteFile-FindFile-make-sure-we-only-search-the-sto.patch
    PATCHFILES += 1116-backport-2da65f4-PlaylistEditorView-don-t-use-itemVisible-if-using-th.patch
    PATCHFILES += 1117-backport-ec6499f-AlbumArt-cycleImage-If-we-only-have-one-image-there-.patch
    PATCHFILES += 1118-backport-3da6e76-UPNP-Fix-music-streaming-following-the-switch-to-sto.patch
    PATCHFILES += 1119-backport-62d3892-UPNP-Fix-upnp-albumart-after-move-to-storage-groups.patch
    PATCHFILES += 1120-backport-68ffe67-MythMusic-fix-filename-for-embedded-images-after-a-f.patch
    PATCHFILES += 1121-backport-b947407-mythutil-make-sure-we-only-use-the-AlbumArt-storage-.patch
    PATCHFILES += 1122-backport-e31b1e8-MythMusic-add-a-check-for-the-AlbumArt-storage-group.patch
    PATCHFILES += 1123-backport-b965886-Playlist-silence-a-failed-query-warning-when-inserti.patch
    PATCHFILES += 1124-backport-0716ca9-MythMusic-add-a-Reset-Database-button-on-the-general.patch
    PATCHFILES += 1125-backport-23c5652-mythutil-send-a-MUSIC_ALBUMART_CHANGED-message-in-Ex.patch
    PATCHFILES += 1126-backport-0b4724b-mythutil-Silence-a-compiler-warning-in-CalcTrackLeng.patch
    PATCHFILES += 1127-backport-a31b85a-EditMetadata-handle-MUSIC_ALBUMART_CHANGED-messages-.patch
    PATCHFILES += 1128-backport-399fc5c-RemoteFile-Prevent-FindFile-causing-the-master-backe.patch
    PATCHFILES += 1129-backport-7f1f206-AlbumArtImages-add-some-additional-debug-messages-to.patch
    PATCHFILES += 1130-backport-e18fb6d-MainServer-fix-the-filename-of-directory-images-in-H.patch
    PATCHFILES += 1131-backport-db39719-MetaIOID3-fix-reading-of-metadata-from-id3-tags-in-..patch
    PATCHFILES += 1132-backport-0e8e2e3-MythMusic-prefer-xiphComment-style-tags-in-flac-file.patch
    PATCHFILES += 1133-backport-e02bbc5-MythMusic-fix-compilation-for-users-of-taglib-1.8.patch
    PATCHFILES += 1134-backport-0cbe729-Attempt-to-fix-compilation-on-freeBSD.patch
    PATCHFILES += 1135-backport-d7e6e24-MythMusic-allow-some-views-to-be-nested-so-you-can-r.patch
#    PATCHFILES += 1136-backport-3615b82-MythMusic-always-start-playback-after-adding-tracks-.patch
    PATCHFILES += 1137-backport-9be71e1-CDRip-Fix-Coverity-ID-1196562-Division-or-modulo-by-.patch
    PATCHFILES += 1138-backport-f89ac50-MythMusic-General-Settings-Fix-Coverity-ID-1196561-U.patch

    PATCHFILES += 2038-Allow-rotating-an-image.-This-can-be-done-either-by-.patch
    PATCHFILES += 2039-Updated-the-configure-script-to-include-the-exif-req.patch
#    PATCHFILES += 2040-Added-the-new-database-tables-and-bumped-the-db-vers.patch
    PATCHFILES += 2041-Added-a-new-jump-point.patch
    PATCHFILES += 2042-Revert-Allow-rotating-an-image.-This-can-be-done-eit.patch
    PATCHFILES += 2043-Added-an-orientation-feature-to-the-MythImage-and-My.patch
    PATCHFILES += 2044-Added-jump-points-and-keybindings-and-the-call-to-th.patch
    PATCHFILES += 2045-Made-the-new-image-service-API-known-to-the-backend.patch
    PATCHFILES += 2046-Added-a-new-menu-entry-in-the-default-theme.patch
    PATCHFILES += 2047-Added-the-gallery-file-for-the-default-theme.patch
    PATCHFILES += 2048-Added-the-image-service-API-to-the-backend.patch
    PATCHFILES += 2049-Added-the-required-service-contracts-for-the-image-s.patch
    PATCHFILES += 2050-Added-the-files-to-synchronize-the-database.patch
    PATCHFILES += 2051-Added-the-files-that-extracts-the-exif-information-f.patch
    PATCHFILES += 2052-Added-the-files-that-holds-all-information-about-a-f.patch
    PATCHFILES += 2053-Updated-the-pro-file.patch
    PATCHFILES += 2054-Added-all-gallery-related-files-to-the-mythfrontend..patch
    PATCHFILES += 2055-Remove-the-zoom-option-it-is-not-supported-by-the-My.patch
    PATCHFILES += 2056-Added-clear-database-option.-This-will-remove-all-co.patch
    PATCHFILES += 2057-Added-the-clear-database-button-to-the-default-theme.patch
    PATCHFILES += 2058-Fixed-the-call-to-start-the-gallery-module-in-the-me.patch
    PATCHFILES += 2059-Removed-the-unused-thumbnail-generation-progressbar.patch
    PATCHFILES += 2060-Set-the-default-zoom-level-to-100.patch
    PATCHFILES += 2061-Fixed-and-added-more-method-header-descriptions.patch
    PATCHFILES += 2062-Fix-a-manual-merge-mistake.patch
    PATCHFILES += 2063-Swap-MythSystem-for-MythSystemLegacy-in-GalleryThumb.patch
    PATCHFILES += 2067-Fix-build-issue-for-older-installed-versions-of-Exiv.patch
    PATCHFILES += 2072-Fix-a-number-of-db-query-issues-in-GalleryDatabaseHe.patch
    PATCHFILES += 2078-Disable-the-old-mythgallery-plugin-by-default.-It-wi.patch
    PATCHFILES += 2086-Fix-several-different-coverity-warnings-relating-to-.patch
    PATCHFILES += 2096-Add-the-New-Image-Gallery-menu-item-to-the-classic-m.patch
    PATCHFILES += 2097-Add-the-New-Image-Gallery-menu-item-to-the-DVR-menu-.patch
    PATCHFILES += 2098-Add-the-New-Image-Gallery-menu-item-to-the-media-cen.patch
    PATCHFILES += 2105-Added-new-service-API-call-to-only-get-the-directori.patch
    PATCHFILES += 2106-Added-new-service-API-calls-to-rename-or-delete-a-ce.patch
    PATCHFILES += 2107-Updated-the-DeleteFile-and-RenameFile-service-API-me.patch
    PATCHFILES += 2123-Use-a-special-storage-group-Photographs-for-the-new-.patch
    PATCHFILES += 2126-Store-a-relative-url-to-the-image-in-the-database-in.patch
    PATCHFILES += 2132-Move-the-Gallery-thumb-generator-thread-class-to-lib.patch
    PATCHFILES += 2160-Fix-mask-image-scaling-after-dfd97aa0.patch
    PATCHFILES += 2270-Move-image-thumbnail-generation-to-the-backend.patch
    PATCHFILES += 2283-Remove-some-stray-references-to-the-ImageThumbGenThr.patch
    PATCHFILES += 2284-disable-schema-check-in-perl-bindings.patch
endif

LICENSE = GPL2

DESCRIPTION = 
define BLURB
endef

DEPENDS = \
	lang/cxx \
	db/mysql \
	lib/alsa-lib \
	lib/avahi \
	lib/fftw3 \
	lib/freetype \
	lib/lame \
	lib/libass \
	lib/libavc1394 \
	lib/libcdio \
	lib/libiec61883 \
	lib/libxml2 \
	lib/openssl \
	lib/taglib \
	lib/zlib \
	python/python \
	python/python-MySQL-python \
	python/python-lxml \
	python/python-urlgrabber \
	qt/qt4 \
	system/lirc \
	system/udev \
	X11/libvdpau \
	xorg/xorg
BUILDDEPS = \
	devel/yasm \
	python/python-distutilscross \
	python/python-MySQL-python \
	python/python-lxml \
	python/python-urlgrabber

DISTNAME_SHORT = $(GARNAME)-$(MYTHTV_GARVERSION_SHORT)

CATEGORY := $(shell basename $(shell dirname $(shell pwd)))

PWD := $(shell pwd)

CONFIGURE_SCRIPTS = $(WORKSRC)/mythtv/configure
BUILD_SCRIPTS     = $(WORKSRC)/mythtv/Makefile
INSTALL_SCRIPTS   = $(WORKSRC)/mythtv/Makefile source

CONFIGURE_ARGS = \
	--compile-type=$(if $(filter yes,$(mm_DEBUG)),"debug","release") \
	--prefix="$(DESTDIR)$(prefix)" \
	--runprefix="$(prefix)" \
	--libdir-name="$(patsubst $(prefix)/%,%,$(libdir))" \
	--disable-ccache \
	--disable-distcc \
	--bindir="$(DESTDIR)$(bindir)" \
	--datadir="$(DESTDIR)$(datadir)/mythtv" \
	--libdir="$(DESTDIR)$(libdir)" \
	--shlibdir="$(DESTDIR)$(libdir)" \
	--incdir="$(DESTDIR)$(includedir)/mythtv" \
	--mandir="$(DESTDIR)$(mandir)" \
	$(if $(filter -Os,$(CFLAGS)),--enable-small) \
	--cross-prefix="$(compiler_prefix)" \
	--enable-cross-compile \
	--sysroot="$(DESTDIR)$(rootdir)" \
	--sysinclude="$(DESTDIR)$(includedir)" \
	--target-os="linux" \
	--nm="$(NM)" \
	--as="$(CC)" \
	--cc="$(CC)" \
	--cxx="$(CXX)" \
	--ld="$(CC)" \
	--qmake="$(DESTDIR)$(qt4bindir)/qmake" \
	--host-cc="$(build_CC)" \
	--host-cflags="$(build_CFLAGS)" \
	--host-ldflags="$(build_LDFLAGS)" \
	--host-libs="" \
	--extra-cflags="$(CFLAGS)" \
	--extra-cxxflags="$(CXXFLAGS)" \
	--extra-ldflags="$(LDFLAGS)" \
	--enable-symbol-visibility \
	--arch=$(GARCH_FAMILY) \
	--tune=$(GARCH) \
	--cpu=$(GARCH) \
	--disable-altivec \
	--enable-amd3dnow \
	--enable-amd3dnowext \
	--enable-mmx \
	--enable-sse \
	--enable-ssse3 \
	--enable-yasm \
	--disable-proc-opt \
	--enable-audio-oss \
	--enable-audio-alsa \
	--disable-audio-jack \
	--disable-audio-pulseoutput \
	--disable-valgrind \
	--enable-lirc \
	--disable-joystick-menu \
	--enable-firewire \
	--disable-hdhomerun \
	--disable-ceton \
	--enable-v4l2 \
	--enable-ivtv \
	--enable-hdpvr \
	--enable-dvb \
	--dvb-path="$(DESTDIR)$(includedir)" \
	--disable-asi \
	--enable-x11 \
	--x11-path="$(DESTDIR)$(includedir)" \
	--enable-xrandr \
	--enable-xv \
	--enable-vdpau \
	--disable-crystalhd \
	--enable-vaapi \
	--disable-dxva2 \
	--enable-opengl-video \
	--disable-quartz-video \
	--disable-mac-bundle \
	--enable-libxml2 \
	--libxml2-path="$(DESTDIR)$(includedir)/libxml2" \
	--enable-libdns_sd \
	--enable-libcrypto \
	--without-bindings="perl" \
	--without-bindings="php" \
	--with-bindings="python" \
	--disable-mythlogserver

#	--enable-libfftw3

CONFIGURE_ENV  = $(MYTHTV_CONFIGURE_ENV)
BUILD_ENV      = $(MYTHTV_BUILD_ENV)
INSTALL_ENV    = $(MYTHTV_INSTALL_ENV)

BUILD_ENV     += PYTHONXCPREFIX=$(DESTDIR)$(prefix)
INSTALL_ENV   += PYTHONPATH=$(DESTDIR)$(PYTHON_libdir)/site-packages

GAR_EXTRA_CONF += python/python/package-api.mk
include ../../gar.mk

CPPFLAGS += -I$(DESTDIR)$(includedir)/avahi-compat-libdns_sd
CFLAGS   += -I$(DESTDIR)$(includedir)/avahi-compat-libdns_sd
CXXFLAGS += -I$(DESTDIR)$(includedir)/avahi-compat-libdns_sd

CPPFLAGS += -fPIC
CFLAGS   += -fPIC

# mythtv 0.25 fails to compile with gcc 4.7.0's link time optimization enabled.
CFLAGS   := $(filter-out -flto, $(CFLAGS))
CXXFLAGS := $(filter-out -flto, $(CXXFLAGS))
LDFLAGS  := $(filter-out -flto, $(LDFLAGS))

svn//%/$(DISTNAME).tar.bz2:
	@$(call FETCH_SVN, http://$*, $(MYTHTV_SVN_VERSION), $(DISTNAME))
	@$(MAKECOOKIE)

checksum-$(DISTNAME).tar.bz2:
	@$(MAKECOOKIE)

install-source:
	@rm -rf $(DESTDIR)$(MYTHTV_SOURCEDIR)
	@mkdir -p $(DESTDIR)$(MYTHTV_SOURCEDIR)
	@rm -rf $(DESTDIR)$(MYTHTV_SOURCEDIR)
	@ln -sf $(PWD)/$(WORKSRC)/mythtv $(DESTDIR)$(MYTHTV_SOURCEDIR)
	@$(MAKECOOKIE)

post-install: post-install-mythtv-version
	@rm -f $(DESTDIR)$(bindir)/mythtv
	@mv $(DESTDIR)$(bindir)/mythavtest $(DESTDIR)$(bindir)/mythtv
	@$(MAKECOOKIE)

post-configure:
	@sed -i -e "s/MYTH_SOURCE_VERSION.*/MYTH_SOURCE_VERSION \"$(MYTHTV_GIT_VERSION)-v`grep "^mm_VERSION_MINIMYTH" ~/.minimyth/minimyth.conf.mk | sed -e 's/.*\?=\s*\([0-9]*\.[0-9]*\.[0-9]*\).*/\1/'`\"/" $(WORKSRC)/mythtv/version.sh
	@sed -i -e "s/MYTH_SOURCE_PATH.*/MYTH_SOURCE_PATH \"$(mm_MYTH_VERSION)\"/" $(WORKSRC)/mythtv/version.sh
	@$(MAKECOOKIE)

clean-all:
	@rm -rf $(DESTDIR)$(bindir)/mtd
	@rm -rf $(DESTDIR)$(bindir)/myth*
	@rm -rf $(DESTDIR)$(datadir)/myth*
	@rm -rf $(DESTDIR)$(includedir)/myth*
	@rm -rf $(DESTDIR)$(libdir)/libmyth*
	@rm -rf $(DESTDIR)$(libdir)/myth*
	@rm -rf $(DESTDIR)$(libdir)/python*/site-packages/MythTV
	@rm -rf $(DESTDIR)$(libdir)/python*/site-packages/MythTV-*
	@$(foreach dir,$(filter-out %/Makefile,$(wildcard ../../myth/* ../../myth-*/*)),$(MAKE) -C $(dir) clean ; )

source-update:
	@$(MAKE) source-update-source
	@$(MAKE) source-update-patches

source-update-source:
	@$(MAKE) clean
	@$(MAKE) fetch
	@$(MAKE) $(GARCHIVEDIR)/$(DISTNAME).tar.bz2
	@$(MAKE) clean

source-update-patches:
	@$(MAKE) clean
	@$(MAKE) extract
	@$(foreach PATCHFILE, $(PATCHFILES), \
		cd $(WORKDIR) || exit 1 ; \
		mv $(DISTNAME) $(DISTNAME)-old || exit 1 ; \
		cp -r $(DISTNAME)-old $(DISTNAME)-new || exit 1 ; \
		cd $(DISTNAME)-new || exit 1 ; \
		SIMPLE_BACKUP_SUFFIX=.gar-source-update-patches patch -p1 < ../../../files/$(PATCHFILE) || exit 1 ; \
		cd ../ || exit 1 ; \
		find $(DISTNAME)-new -name *.gar-source-update-patches -exec rm {} \; || exit 1 ; \
		( diff -Naur $(DISTNAME)-old $(DISTNAME)-new > ../../files/$(PATCHFILE) ; test $$? -lt 2 ) || exit 1 ; \
		rm -fr $(DISTNAME)-old || exit 1 ; \
		mv $(DISTNAME)-new $(DISTNAME) || exit 1 ; \
		cd ../../ || exit 1 ; \
		rm -f checksums~ || exit 1 ; \
		cat checksums | grep -v $(DOWNLOADDIR)/$(PATCHFILE) > checksums~ || true ; \
		md5sum $(DOWNLOADDIR)/$(PATCHFILE) >> checksums~ || exit 1 ; \
		rm -f checksums || exit 1 ; \
		mv -f checksums~ checksums || exit 1 ; )
	@$(MAKE) clean
