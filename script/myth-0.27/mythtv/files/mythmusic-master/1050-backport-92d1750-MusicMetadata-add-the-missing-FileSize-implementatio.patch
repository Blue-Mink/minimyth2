From 92d175050a60796b542134a59f68c3b4fa6689c3 Mon Sep 17 00:00:00 2001
From: Paul Harrison <pharrison@mythtv.org>
Date: Sat, 8 Feb 2014 19:35:35 +0000
Subject: [PATCH 2/6] MusicMetadata: add the missing FileSize() implementation

---
 mythplugins/mythmusic/mythmusic/playlist.cpp |    6 ++----
 mythtv/libs/libmythmetadata/musicmetadata.h  |    2 +-
 2 files changed, 3 insertions(+), 5 deletions(-)

diff --git a/mythplugins/mythmusic/mythmusic/playlist.cpp b/mythplugins/mythmusic/mythmusic/playlist.cpp
index e44e08f..b794ef1 100644
--- a/mythplugins/mythmusic/mythmusic/playlist.cpp
+++ b/mythplugins/mythmusic/mythmusic/playlist.cpp
@@ -1140,10 +1140,7 @@ void Playlist::computeSize(double &size_in_MB, double &size_in_sec)
                 LOG(VB_GENERAL, LOG_ERR, "Computing track lengths. "
                                          "One track <=0");
 
-            // Check tmpdata->Filename
-            QFileInfo finfo(mdata->Filename());
-
-            size_in_MB += finfo.size() / 1000000;
+            size_in_MB += mdata->FileSize() / 1000000;
         }
     }
 }
@@ -1232,6 +1229,7 @@ void Playlist::processExit(uint retval)
     m_procExitVal = retval;
 }
 
+// FIXME: this needs updating to work with storage groups
 int Playlist::CreateCDMP3(void)
 {
     // Check & get global settings
diff --git a/mythtv/libs/libmythmetadata/musicmetadata.h b/mythtv/libs/libmythmetadata/musicmetadata.h
index 15142fa..378a15a 100644
--- a/mythtv/libs/libmythmetadata/musicmetadata.h
+++ b/mythtv/libs/libmythmetadata/musicmetadata.h
@@ -202,7 +202,7 @@ class META_PUBLIC MusicMetadata
     QString Hostname(void) { return m_hostname; }
     void setHostname(const QString &host) { m_hostname = host; }
 
-    uint64_t FileSize() const;
+    uint64_t FileSize() const { return m_fileSize; }
     void setFileSize(uint64_t lfilesize) { m_fileSize = lfilesize; }
 
     QString Format() const { return m_format; }
-- 
1.7.10

