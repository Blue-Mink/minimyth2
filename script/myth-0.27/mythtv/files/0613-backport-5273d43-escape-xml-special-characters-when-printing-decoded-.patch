From 5273d4364c96bfc5fd4fc651160e01334a90a343 Mon Sep 17 00:00:00 2001
From: Karl Dietz <dekarl@mythtv.org>
Date: Sun, 9 Nov 2014 23:45:33 +0100
Subject: [PATCH] escape xml special characters when printing decoded
 descriptors

fixes point 3b of the ticket

Fixes #11812
---
 mythtv/libs/libmythtv/mpeg/mpegdescriptors.cpp |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/mythtv/libs/libmythtv/mpeg/mpegdescriptors.cpp b/mythtv/libs/libmythtv/mpeg/mpegdescriptors.cpp
index f32a044..ab89bf3 100644
--- a/mythtv/libs/libmythtv/mpeg/mpegdescriptors.cpp
+++ b/mythtv/libs/libmythtv/mpeg/mpegdescriptors.cpp
@@ -3,6 +3,8 @@
 
 #include <limits.h>
 
+#include <QTextDocument> // for escape (note escape misses &apos; TODO fix upstream)
+
 #include "sctedescriptors.h"
 #include "atscdescriptors.h"
 #include "dvbdescriptors.h"
@@ -476,7 +478,7 @@ QString MPEGDescriptor::toStringXML(uint level) const
 
     str += "\n" + indent_1 + "</Data>\n";
 
-    str += indent_1 + "<Decoded>" + toString() + "</Decoded>\n";
+    str += indent_1 + "<Decoded>" + Qt::escape (toString()) + "</Decoded>\n";
 
     str += indent_0 + "</Descriptor>";
 
-- 
1.7.10.2

