From 338c49a7356a8a4637dfe2047d40b14cb3960393 Mon Sep 17 00:00:00 2001
From: Jean-Yves Avenard <jyavenard@mythtv.org>
Date: Fri, 20 Jun 2014 12:05:15 +1000
Subject: [PATCH] =?UTF-8?q?Stop=20readahead=20thread=20if=20the=20file=20isn?=
 =?UTF-8?q?=E2=80=99t=20opened=20try=20#2?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

No point trying to read from the file when thereâ€™s nothing to read
---
 mythtv/libs/libmythtv/ringbuffer.cpp |   14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/mythtv/libs/libmythtv/ringbuffer.cpp b/mythtv/libs/libmythtv/ringbuffer.cpp
index f1d9c54..c7b5ebf 100644
--- a/mythtv/libs/libmythtv/ringbuffer.cpp
+++ b/mythtv/libs/libmythtv/ringbuffer.cpp
@@ -908,6 +908,20 @@ void RingBuffer::run(void)
 
     while (readaheadrunning)
     {
+        rwlock.unlock();
+        bool isopened = IsOpen();
+        rwlock.lockForRead();
+
+        if (!isopened)
+        {
+            LOG(VB_FILE, LOG_WARNING, LOC +
+                QString("File not opened, terminating readahead thread"));
+            poslock.lockForWrite();
+            readaheadrunning = false;
+            generalWait.wakeAll();
+            poslock.unlock();
+            break;
+        }
         if (PauseAndWait())
         {
             ignore_for_read_timing = true;
-- 
1.7.10.2

