From e3ab9ec16e34984bd0152a5097b16920d024dd20 Mon Sep 17 00:00:00 2001
From: David Engel <dengel@mythtv.org>
Date: Wed, 18 Jun 2014 14:24:46 -0500
Subject: [PATCH 08/10] Make sure some recording rule failures get reported
 properly.

---
 mythtv/libs/libmythtv/recordingrule.cpp      |    6 +++++-
 mythtv/programs/mythbackend/services/dvr.cpp |   10 ++++------
 2 files changed, 9 insertions(+), 7 deletions(-)

diff --git a/mythtv/libs/libmythtv/recordingrule.cpp b/mythtv/libs/libmythtv/recordingrule.cpp
index 3d4625b..65eedd8 100644
--- a/mythtv/libs/libmythtv/recordingrule.cpp
+++ b/mythtv/libs/libmythtv/recordingrule.cpp
@@ -478,8 +478,12 @@ bool RecordingRule::Save(bool sendSig)
         query.bindValue(":RECORDID", m_recordID);
 
     if (!query.exec())
+    {
         MythDB::DBError("UPDATE/INSERT record", query);
-    else if (m_recordTable != "record" && m_tempID <= 0)
+        return false;
+    }
+
+    if (m_recordTable != "record" && m_tempID <= 0)
         m_tempID = query.lastInsertId().toInt();
     else if (m_recordID <= 0)
         m_recordID = query.lastInsertId().toInt();
diff --git a/mythtv/programs/mythbackend/services/dvr.cpp b/mythtv/programs/mythbackend/services/dvr.cpp
index ed89b07..cad7a6c 100644
--- a/mythtv/programs/mythbackend/services/dvr.cpp
+++ b/mythtv/programs/mythbackend/services/dvr.cpp
@@ -932,9 +932,9 @@ bool Dvr::UpdateRecordSchedule ( uint      nRecordId,
     if (!pRule.IsValid(msg))
         throw msg;
 
-    pRule.Save();
+    bool bResult = pRule.Save();
 
-    return true;
+    return bResult;
 }
 
 bool Dvr::RemoveRecordSchedule ( uint nRecordId )
@@ -1099,8 +1099,7 @@ bool Dvr::EnableRecordSchedule ( uint nRecordId )
     if (pRule.IsLoaded())
     {
         pRule.m_isInactive = false;
-        pRule.Save();
-        bResult = true;
+        bResult = pRule.Save();
     }
 
     return bResult;
@@ -1120,8 +1119,7 @@ bool Dvr::DisableRecordSchedule( uint nRecordId )
     if (pRule.IsLoaded())
     {
         pRule.m_isInactive = true;
-        pRule.Save();
-        bResult = true;
+        bResult = pRule.Save();
     }
 
     return bResult;
-- 
1.7.10.2

