From 7caf30aa8ab3c328dfacd4b3f0d459084ee02aaa Mon Sep 17 00:00:00 2001
From: Jonatan Lindblad <jlindblad@mythtv.org>
Date: Sun, 8 Jun 2014 01:10:42 +0200
Subject: [PATCH 11/23] MythNetvision: Fix some cppcheck warnings.

---
 .../mythnetvision/mythnetvision/netbase.cpp        |    2 +-
 .../mythnetvision/mythnetvision/netsearch.cpp      |   19 ++++++----------
 .../mythnetvision/mythnetvision/netsearch.h        |    7 ------
 .../mythnetvision/mythnetvision/nettree.cpp        |   24 +++++---------------
 mythplugins/mythnetvision/mythnetvision/nettree.h  |    5 ----
 .../mythnetvision/mythnetvision/rsseditor.cpp      |    7 +++---
 .../mythnetvision/mythnetvision/searcheditor.cpp   |    1 -
 7 files changed, 17 insertions(+), 48 deletions(-)

diff --git a/mythplugins/mythnetvision/mythnetvision/netbase.cpp b/mythplugins/mythnetvision/mythnetvision/netbase.cpp
index 195cde2..a4899ef 100644
--- a/mythplugins/mythnetvision/mythnetvision/netbase.cpp
+++ b/mythplugins/mythnetvision/mythnetvision/netbase.cpp
@@ -243,7 +243,7 @@ void NetBase::customEvent(QEvent *event)
 {
     if ((MythEvent::Type)(event->type()) == MythEvent::MythEventMessage)
     {
-        MythEvent *me = (MythEvent *)event;
+        MythEvent *me = static_cast<MythEvent *>(event);
         QStringList tokens = me->Message().split(" ", QString::SkipEmptyParts);
 
         if (tokens.isEmpty())
diff --git a/mythplugins/mythnetvision/mythnetvision/netsearch.cpp b/mythplugins/mythnetvision/mythnetvision/netsearch.cpp
index b7739a6..f2d51a4 100644
--- a/mythplugins/mythnetvision/mythnetvision/netsearch.cpp
+++ b/mythplugins/mythnetvision/mythnetvision/netsearch.cpp
@@ -37,20 +37,17 @@ NetSearch::NetSearch(MythScreenStack *parent, const char *name)
       m_noSites(NULL),               m_progress(NULL),
       m_okPopup(NULL),               m_netSearch(NULL),
 
-      m_reply(NULL),                 m_download(new MythDownloadManager()),
+      m_reply(NULL),
       m_currentSearch(QString()),    m_currentGrabber(0),
       m_currentCmd(QString()),       m_pagenum(0),
-      m_maxpage(0),                  m_playing(false),
-      m_redirects(0),                m_mythXML(GetMythXMLURL())
+      m_maxpage(0),                  m_mythXML(GetMythXMLURL())
 {
 }
 
 bool NetSearch::Create()
 {
-    bool foundtheme = false;
-
     // Load the theme for this screen
-    foundtheme = LoadWindowFromXML("netvision-ui.xml", "netsearch", this);
+    bool foundtheme = LoadWindowFromXML("netvision-ui.xml", "netsearch", this);
 
     if (!foundtheme)
         return false;
@@ -113,9 +110,6 @@ NetSearch::~NetSearch()
         m_netSearch->deleteLater();
         m_netSearch = NULL;
     }
-
-    delete m_download;
-    m_download = NULL;
 }
 
 void NetSearch::loadData(void)
@@ -136,9 +130,9 @@ bool NetSearch::keyPressEvent(QKeyEvent *event)
     if (GetFocusWidget()->keyPressEvent(event))
         return true;
 
-    bool handled = false;
     QStringList actions;
-    handled = GetMythMainWindow()->TranslateKeyPress("Internet Video", event, actions);
+    bool handled = GetMythMainWindow()->TranslateKeyPress("Internet Video",
+                                                          event, actions);
 
     for (int i = 0; i < actions.size() && !handled; i++)
     {
@@ -271,7 +265,8 @@ void NetSearch::doSearch()
                     .arg(grabber).arg(query);
     CreateBusyDialog(title);
 
-    m_netSearch = new QNetworkAccessManager(this);
+    if (!m_netSearch)
+        m_netSearch = new QNetworkAccessManager(this);
     connect(m_netSearch, SIGNAL(finished(QNetworkReply*)),
                        SLOT(searchFinished(void)));
 
diff --git a/mythplugins/mythnetvision/mythnetvision/netsearch.h b/mythplugins/mythnetvision/mythnetvision/netsearch.h
index 8071196..0c0ed42 100644
--- a/mythplugins/mythnetvision/mythnetvision/netsearch.h
+++ b/mythplugins/mythnetvision/mythnetvision/netsearch.h
@@ -22,9 +22,6 @@ class NetSearch : public NetBase
 
   public:
 
-    enum DialogType { DLG_DEFAULT = 0, DLG_SEARCH = 0x1, DLG_RSS = 0x2,
-                      dtLast };
-
     NetSearch(MythScreenStack *parent, const char *name = 0);
     ~NetSearch();
 
@@ -51,19 +48,15 @@ class NetSearch : public NetBase
 
     QNetworkAccessManager *m_netSearch;
     QNetworkReply         *m_reply;
-    MythDownloadManager   *m_download;
 
     QString             m_currentSearch;
     int                 m_currentGrabber;
     QString             m_currentCmd;
     uint                m_pagenum;
     uint                m_maxpage;
-    bool                m_playing;
-    uint                m_redirects;
     QString             m_mythXML;
 
     RSSSite::rssList    m_rssList;
-    QMap<MythUIButtonListItem*,ResultItem> m_rssitems;
 
   private slots:
     void showMenu(void);
diff --git a/mythplugins/mythnetvision/mythnetvision/nettree.cpp b/mythplugins/mythnetvision/mythnetvision/nettree.cpp
index cab7987..ae6a903 100644
--- a/mythplugins/mythnetvision/mythnetvision/nettree.cpp
+++ b/mythplugins/mythnetvision/mythnetvision/nettree.cpp
@@ -43,9 +43,8 @@ NetTree::NetTree(DialogType type, MythScreenStack *parent, const char *name)
     : NetBase(parent, name),
       m_siteMap(NULL),               m_siteButtonList(NULL),
       m_siteGeneric(NULL),           m_rssGeneric(NULL),
-      m_searchGeneric(NULL),         m_currentNode(NULL),
-      m_noSites(NULL),               m_gdt(new GrabberDownloadThread(this)),
-      m_type(type)
+      m_currentNode(NULL),           m_noSites(NULL),
+      m_gdt(new GrabberDownloadThread(this)), m_type(type)
 {
     connect(m_gdt, SIGNAL(finished()), SLOT(doTreeRefresh()));
     m_updateFreq = gCoreContext->GetNumSetting(
@@ -327,7 +326,7 @@ void NetTree::handleSelect(MythUIButtonListItem *item)
         {
             streamWebVideo();
         }
-    };
+    }
     slotItemChanged();
 }
 
@@ -367,9 +366,9 @@ bool NetTree::keyPressEvent(QKeyEvent *event)
     if (GetFocusWidget()->keyPressEvent(event))
         return true;
 
-    bool handled = false;
     QStringList actions;
-    handled = GetMythMainWindow()->TranslateKeyPress("Internet Video", event, actions);
+    bool handled = GetMythMainWindow()->TranslateKeyPress("Internet Video",
+                                                          event, actions);
 
     for (int i = 0; i < actions.size() && !handled; i++)
     {
@@ -526,7 +525,7 @@ void NetTree::fillTree()
     // Add an upfolder
     if (m_type != DLG_TREE)
     {
-          m_rssGeneric->addNode(tr("Back"), kUpFolder, true, false);
+        m_rssGeneric->addNode(tr("Back"), kUpFolder, true, false);
     }
 
     m_rssGeneric->SetData(QString("%1/mythnetvision/icons/rss.png")
@@ -641,17 +640,6 @@ void NetTree::buildGenericTree(MythGenericTree *dst, QStringList paths,
     }
 }
 
-MythGenericTree *NetTree::AddDirNode(MythGenericTree *where_to_add,
-            QString name, QString thumbnail)
-{
-    QString title = name;
-    title.replace("&amp;", "&");
-    MythGenericTree *sub_node =
-            where_to_add->addNode(title, kSubFolder, false);
-    sub_node->SetData(thumbnail);
-    return sub_node;
-}
-
 int NetTree::AddFileNode(MythGenericTree *where_to_add, ResultItem *video)
 {
     QString title = video->GetTitle();
diff --git a/mythplugins/mythnetvision/mythnetvision/nettree.h b/mythplugins/mythnetvision/mythnetvision/nettree.h
index e6d9d13..6a59778 100644
--- a/mythplugins/mythnetvision/mythnetvision/nettree.h
+++ b/mythplugins/mythnetvision/mythnetvision/nettree.h
@@ -70,9 +70,6 @@ class NetTree : public NetBase
                           QString dirthumb,
                           QList<ResultItem*> videos);
 
-    MythGenericTree *AddDirNode(
-                    MythGenericTree *where_to_add,
-                    QString name, QString thumbnail);
     int AddFileNode(MythGenericTree *where_to_add,
                     ResultItem *video);
 
@@ -85,7 +82,6 @@ class NetTree : public NetBase
     MythUIButtonList   *m_siteButtonList;
     MythGenericTree    *m_siteGeneric;
     MythGenericTree    *m_rssGeneric;
-    MythGenericTree    *m_searchGeneric;
     MythGenericTree    *m_currentNode;
 
     MythUIText         *m_noSites;
@@ -131,4 +127,3 @@ class NetTree : public NetBase
 };
 
 #endif
-
diff --git a/mythplugins/mythnetvision/mythnetvision/rsseditor.cpp b/mythplugins/mythnetvision/mythnetvision/rsseditor.cpp
index e133e9e..d8df126 100644
--- a/mythplugins/mythnetvision/mythnetvision/rsseditor.cpp
+++ b/mythplugins/mythnetvision/mythnetvision/rsseditor.cpp
@@ -136,9 +136,9 @@ bool RSSEditPopup::keyPressEvent(QKeyEvent *event)
     if (GetFocusWidget()->keyPressEvent(event))
         return true;
 
-    bool handled = false;
     QStringList actions;
-    handled = GetMythMainWindow()->TranslateKeyPress("Internet Video", event, actions);
+    bool handled = GetMythMainWindow()->TranslateKeyPress("Internet Video",
+                                                          event, actions);
 
     if (!handled && MythScreenType::keyPressEvent(event))
         handled = true;
@@ -448,9 +448,8 @@ bool RSSEditor::keyPressEvent(QKeyEvent *event)
     if (GetFocusWidget()->keyPressEvent(event))
         return true;
 
-    bool handled = false;
     QStringList actions;
-    handled = GetMythMainWindow()->TranslateKeyPress("Internet Video", event, actions);
+    bool handled = GetMythMainWindow()->TranslateKeyPress("Internet Video", event, actions);
 
     for (int i = 0; i < actions.size() && !handled; i++)
     {
diff --git a/mythplugins/mythnetvision/mythnetvision/searcheditor.cpp b/mythplugins/mythnetvision/mythnetvision/searcheditor.cpp
index 6d58681..ed12ab5 100644
--- a/mythplugins/mythnetvision/mythnetvision/searcheditor.cpp
+++ b/mythplugins/mythnetvision/mythnetvision/searcheditor.cpp
@@ -25,4 +25,3 @@ bool SearchEditor::Matches(bool search, bool /*tree*/)
 {
     return search;
 }
-
-- 
1.7.10.2

