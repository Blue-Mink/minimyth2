From 8eb969eb7fd9beafcc822970e812b805441a3f0f Mon Sep 17 00:00:00 2001
From: Jonatan Lindblad <jlindblad@mythtv.org>
Date: Sun, 8 Jun 2014 01:10:43 +0200
Subject: [PATCH 20/23] MythNetvision: Set childcount and other text fields in
 the tree view

---
 mythplugins/mythnetvision/mythnetvision/nettree.cpp |   19 +++++++++++++++++--
 mythplugins/mythnetvision/mythnetvision/nettree.h   |    5 +++--
 2 files changed, 20 insertions(+), 4 deletions(-)

diff --git a/mythplugins/mythnetvision/mythnetvision/nettree.cpp b/mythplugins/mythnetvision/mythnetvision/nettree.cpp
index 1004e11..3c5106f 100644
--- a/mythplugins/mythnetvision/mythnetvision/nettree.cpp
+++ b/mythplugins/mythnetvision/mythnetvision/nettree.cpp
@@ -548,9 +548,11 @@ void NetTree::FillTree()
             ResultItem::resultList::iterator it = items.begin();
             for (; it != items.end(); ++it)
                 AddFileNode(ret, *it);
+            SetSubfolderData(ret);
         }
 
         m_siteGeneric->addNode(rssGeneric);
+        SetSubfolderData(rssGeneric);
     }
 
     // Now let's add all the grabber trees
@@ -582,6 +584,7 @@ void NetTree::FillTree()
             BuildGenericTree(ret, curPaths, dirthumb, videos);
         }
         m_siteGeneric->addNode(ret);
+        SetSubfolderData(ret);
     }
 }
 
@@ -623,16 +626,21 @@ void NetTree::BuildGenericTree(MythGenericTree *dst, QStringList paths,
                 it != videos.end(); ++it)
             AddFileNode(folder, *it);
     }
+    SetSubfolderData(folder);
 }
 
-int NetTree::AddFileNode(MythGenericTree *where_to_add, ResultItem *video)
+void NetTree::AddFileNode(MythGenericTree *where_to_add, ResultItem *video)
 {
     QString title = video->GetTitle();
     title.replace("&amp;", "&");
     MythGenericTree *sub_node = where_to_add->addNode(title, 0, true);
     sub_node->SetData(qVariantFromValue(video));
+
+    InfoMap textMap;
+    video->toMap(textMap);
+    sub_node->SetTextFromMap(textMap);
+
     m_videos.append(video);
-    return 1;
 }
 
 ResultItem* NetTree::GetStreamItem()
@@ -966,3 +974,10 @@ void NetTree::customEvent(QEvent *event)
     else
         NetBase::customEvent(event);
 }
+
+void NetTree::SetSubfolderData(MythGenericTree *folder)
+{
+    folder->SetText(QString("%1").arg(folder->visibleChildCount()),
+                    "childcount");
+    folder->DisplayState("subfolder", "nodetype");
+}
diff --git a/mythplugins/mythnetvision/mythnetvision/nettree.h b/mythplugins/mythnetvision/mythnetvision/nettree.h
index cdf5af4..da911fd 100644
--- a/mythplugins/mythnetvision/mythnetvision/nettree.h
+++ b/mythplugins/mythnetvision/mythnetvision/nettree.h
@@ -68,11 +68,12 @@ class NetTree : public NetBase
                           QString dirthumb,
                           QList<ResultItem*> videos);
 
-    int AddFileNode(MythGenericTree *where_to_add,
-                    ResultItem *video);
+    void AddFileNode(MythGenericTree *where_to_add,
+                     ResultItem *video);
 
     void SwitchView(void);
 
+    void SetSubfolderData(MythGenericTree *folder);
     void UpdateResultItem(ResultItem *item);
     void UpdateSiteItem(RSSSite *site);
     void UpdateCurrentItem(void);
-- 
1.7.10.2

