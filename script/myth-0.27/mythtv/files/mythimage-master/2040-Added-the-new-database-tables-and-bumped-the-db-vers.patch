From e22dcf147c4dbd2bb5cd2265effdbe3b12a70978 Mon Sep 17 00:00:00 2001
From: Robert Siebert <rsiebert@miroku.no-ip.com>
Date: Wed, 20 Mar 2013 11:06:35 +0100
Subject: [PATCH 040/760] Added the new database tables and bumped the db
 version.

Signed-off-by: Stuart Morgan <smorgan@mythtv.org>
---
 mythtv/libs/libmythbase/mythversion.h |    2 +-
 mythtv/libs/libmythtv/dbcheck.cpp     |   42 +++++++++++++++++++++++++++++++++
 2 files changed, 43 insertions(+), 1 deletion(-)

diff --git a/mythtv/libs/libmythbase/mythversion.h b/mythtv/libs/libmythbase/mythversion.h
index cf10efb..1ad2d46 100644
--- a/mythtv/libs/libmythbase/mythversion.h
+++ b/mythtv/libs/libmythbase/mythversion.h
@@ -61,7 +61,7 @@
  *      mythtv/bindings/php/MythBackend.php
 #endif
 
-#define MYTH_DATABASE_VERSION "1317"
+#define MYTH_DATABASE_VERSION "1318"
 
 
  MBASE_PUBLIC  const char *GetMythSourceVersion();
diff --git a/mythtv/libs/libmythtv/dbcheck.cpp b/mythtv/libs/libmythtv/dbcheck.cpp
index fe65eda..db8d59b 100644
--- a/mythtv/libs/libmythtv/dbcheck.cpp
+++ b/mythtv/libs/libmythtv/dbcheck.cpp
@@ -2480,6 +2480,48 @@ NULL
             return false;
     }
 
+    if (dbver == "1317")
+    {
+        const char *updates[] = {
+            "CREATE TABLE IF NOT EXISTS gallery_directories ("
+            "  dir_id       INT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,"
+            "  filename     VARCHAR(255) NOT NULL,"
+            "  name         VARCHAR(255) NOT NULL,"
+            "  path         VARCHAR(255) NOT NULL,"
+            "  parent_id    INT(11) NOT NULL,"
+            "  dir_count    INT(11) NOT NULL DEFAULT '0',"
+            "  file_count   INT(11) NOT NULL DEFAULT '0',"
+            "  hidden       TINYINT(1) NOT NULL DEFAULT '0'"
+            ") ENGINE=MyISAM DEFAULT CHARSET=utf8;",
+            "CREATE TABLE IF NOT EXISTS gallery_files ("
+            "  file_id      INT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,"
+            "  filename     VARCHAR(255) NOT NULL,"
+            "  name         VARCHAR(255) NOT NULL,"
+            "  path         VARCHAR(255) NOT NULL,"
+            "  dir_id       INT(11) NOT NULL DEFAULT '0',"
+            "  type         INT(11) NOT NULL DEFAULT '0',"
+            "  modtime      INT(11) NOT NULL DEFAULT '0',"
+            "  size         INT(11) NOT NULL DEFAULT '0',"
+            "  extension    VARCHAR(255) NOT NULL,"
+            "  angle        INT(11) NOT NULL DEFAULT '0',"
+            "  date         INT(11) NOT NULL DEFAULT '0',"
+            "  zoom         INT(11) NOT NULL DEFAULT '0',"
+            "  hidden       TINYINT(1) NOT NULL DEFAULT '0',"
+            "  orientation  INT(11) NOT NULL DEFAULT '0'"
+            ") ENGINE=MyISAM DEFAULT CHARSET=utf8;",
+            "INSERT INTO settings VALUES ('ImageStorageGroupName', 'Images', NULL);",
+            "INSERT INTO settings VALUES ('ImageSortOrder', 0, NULL);",
+            "INSERT INTO settings VALUES ('ImageShowHiddenFiles', 0, NULL);",
+            "INSERT INTO settings VALUES ('ImageSlideShowTime', 3500, NULL);",
+            "INSERT INTO settings VALUES ('ImageTransitionType', 1, NULL);",
+            "INSERT INTO settings VALUES ('ImageTransitionTime', 1000, NULL);",
+            NULL
+        };
+
+        if (!performActualUpdate(&updates[0], "1318", dbver))
+            return false;
+    }
+    
 
     return true;
 }
-- 
1.7.10.2

