From ec0e45f3d114c1d6f06388742c876043529aa6b3 Mon Sep 17 00:00:00 2001
From: Stuart Morgan <smorgan@mythtv.org>
Date: Sat, 21 Sep 2013 17:47:37 +0100
Subject: [PATCH 086/760] Fix several different coverity warnings relating to
 the new gallery code

---
 mythtv/programs/mythbackend/services/image.cpp     |    2 ++
 .../mythfrontend/gallerythumbgenthread.cpp         |    9 +++--
 mythtv/programs/mythfrontend/galleryview.cpp       |    1 +
 mythtv/programs/mythfrontend/galleryviewhelper.cpp |    7 ++--
 mythtv/programs/mythfrontend/gallerywidget.cpp     |   38 +++++++-------------
 5 files changed, 21 insertions(+), 36 deletions(-)

diff --git a/mythtv/programs/mythbackend/services/image.cpp b/mythtv/programs/mythbackend/services/image.cpp
index 44a7cb2..6061ed6 100644
--- a/mythtv/programs/mythbackend/services/image.cpp
+++ b/mythtv/programs/mythbackend/services/image.cpp
@@ -306,6 +306,8 @@ bool Image::RemoveImage( int id )
         return false;
     }
 
+    delete im;
+
     // Remove the database entry if the file has been deleted.
     return RemoveImageFromDB(id);
 }
diff --git a/mythtv/programs/mythfrontend/gallerythumbgenthread.cpp b/mythtv/programs/mythfrontend/gallerythumbgenthread.cpp
index f7e973c..8a72509 100644
--- a/mythtv/programs/mythfrontend/gallerythumbgenthread.cpp
+++ b/mythtv/programs/mythfrontend/gallerythumbgenthread.cpp
@@ -19,12 +19,11 @@
  *  \return void
  */
 GalleryThumbGenThread::GalleryThumbGenThread()
+        :   m_fileHelper(new GalleryFileHelper()),
+            m_dbHelper(new GalleryDatabaseHelper()),
+            m_width(0), m_height(0),
+            m_pause(false), m_fileListSize(0)
 {
-    m_fileHelper = new GalleryFileHelper();
-    m_dbHelper = new GalleryDatabaseHelper();
-
-    m_fileListSize = 0;
-    m_pause = false;
 }
 
 
diff --git a/mythtv/programs/mythfrontend/galleryview.cpp b/mythtv/programs/mythfrontend/galleryview.cpp
index 5990c35..eeb5c68 100644
--- a/mythtv/programs/mythfrontend/galleryview.cpp
+++ b/mythtv/programs/mythfrontend/galleryview.cpp
@@ -19,6 +19,7 @@ GalleryView::GalleryView(MythScreenStack *parent, const char *name)
     : MythScreenType(parent, name),
       m_menuPopup(NULL),
       m_confirmPopup(NULL),
+      m_inputPopup(NULL),
       m_imageList(NULL),
       m_captionText(NULL),
       m_crumbsText(NULL),
diff --git a/mythtv/programs/mythfrontend/galleryviewhelper.cpp b/mythtv/programs/mythfrontend/galleryviewhelper.cpp
index 9ebea73..3f431d4 100644
--- a/mythtv/programs/mythfrontend/galleryviewhelper.cpp
+++ b/mythtv/programs/mythfrontend/galleryviewhelper.cpp
@@ -156,11 +156,8 @@ void GalleryViewHelper::LoadTreeData()
     m_thumbGenThread->start();
 
     // clean up
-    if (dirList)
-        delete dirList;
-
-    if (fileList)
-        delete fileList;
+    delete dirList;
+    delete fileList;
 }
 
 
diff --git a/mythtv/programs/mythfrontend/gallerywidget.cpp b/mythtv/programs/mythfrontend/gallerywidget.cpp
index 8b02ee9..f8b1007 100644
--- a/mythtv/programs/mythfrontend/gallerywidget.cpp
+++ b/mythtv/programs/mythfrontend/gallerywidget.cpp
@@ -107,36 +107,25 @@ GalleryWidget::GalleryWidget(MythScreenStack *parent,
 GalleryWidget::~GalleryWidget()
 {
     if (m_timer)
-    {
         m_timer->stop();
-        delete m_timer;
-        m_timer = NULL;
-    }
 
-    if (m_fileList)
-    {
-        delete m_fileList;
-        m_fileList = NULL;
-    }
+    delete m_timer;
+    m_timer = NULL;
 
-    if (m_fileDataList)
-    {
-        delete m_fileDataList;
-        m_fileDataList = NULL;
-    }
+    delete m_fileList;
+    m_fileList = NULL;
 
-    if (m_fh)
-    {
-        delete m_fh;
-        m_fh = NULL;
-    }
+    delete m_fileDataList;
+    m_fileDataList = NULL;
+
+    delete m_fh;
+    m_fh = NULL;
 
     if (m_ilt)
-    {
         m_ilt->wait();
-        delete m_ilt;
-        m_ilt = NULL;
-    }
+
+    delete m_ilt;
+    m_ilt = NULL;
 
     // Set the selected image in the gallery view to the saved one
     // so that the initially selected image is the correct one again.
@@ -435,10 +424,7 @@ void GalleryWidget::ShowFileDetails()
 {
     ImageMetadata *im = m_fileDataList->at(m_index);
     if (!im)
-    {
-        delete im;
         return;
-    }
 
     if (im->m_type != kImageFile)
     {
-- 
1.7.10.2

