From ef4cf25af5fe2318d6142912ff3b36c5120ebd35 Mon Sep 17 00:00:00 2001
From: Jean-Yves Avenard <jyavenard@mythtv.org>
Date: Fri, 30 May 2014 14:52:46 +1000
Subject: [PATCH 07/28] Fix crashes when playing nuv files

regression introduced by FFmpeg 2.2 resync
---
 mythtv/libs/libmythtv/nuppeldecoder.cpp |    3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/mythtv/libs/libmythtv/nuppeldecoder.cpp b/mythtv/libs/libmythtv/nuppeldecoder.cpp
index 8266da4..932d6e2 100644
--- a/mythtv/libs/libmythtv/nuppeldecoder.cpp
+++ b/mythtv/libs/libmythtv/nuppeldecoder.cpp
@@ -838,7 +838,6 @@ bool NuppelDecoder::DecodeFrame(struct rtframeheader *frameheader,
     int r;
     lzo_uint out_len;
     int compoff = 0;
-    AVPacket pkt;
 
     unsigned char *outbuf = frame->buf;
     directframe = frame;
@@ -914,6 +913,8 @@ bool NuppelDecoder::DecodeFrame(struct rtframeheader *frameheader,
             InitAVCodecVideo(frameheader->comptype - '3');
 
         AVFrame mpa_pic;
+        avcodec_get_frame_defaults(&mpa_pic);
+        AVPacket pkt;
         av_init_packet(&pkt);
         pkt.data = lstrm;
         pkt.size = frameheader->packetlength;
-- 
1.7.10.2

