From c7cb70b546eee2bfa6fa908d1dacdc4424003b5b Mon Sep 17 00:00:00 2001
From: Jonatan Lindblad <jlindblad@mythtv.org>
Date: Sun, 8 Jun 2014 01:10:43 +0200
Subject: [PATCH 17/23] MythNetvision: Simplify busy dialog handling

---
 mythplugins/mythnetvision/mythnetvision/netbase.cpp  |   18 ------------------
 mythplugins/mythnetvision/mythnetvision/netbase.h    |    2 --
 .../mythnetvision/mythnetvision/netsearch.cpp        |   18 +++++-------------
 mythplugins/mythnetvision/mythnetvision/nettree.cpp  |   10 +++-------
 4 files changed, 8 insertions(+), 40 deletions(-)

diff --git a/mythplugins/mythnetvision/mythnetvision/netbase.cpp b/mythplugins/mythnetvision/mythnetvision/netbase.cpp
index eb00f9d..80abc7a 100644
--- a/mythplugins/mythnetvision/mythnetvision/netbase.cpp
+++ b/mythplugins/mythnetvision/mythnetvision/netbase.cpp
@@ -17,7 +17,6 @@ NetBase::NetBase(MythScreenStack *parent, const char *name)
     : MythScreenType(parent, name),
       m_thumbImage(NULL),
       m_downloadable(NULL),
-      m_busyPopup(NULL),
       m_popupStack(GetMythMainWindow()->GetStack("popup stack")),
       m_progressDialog(NULL),
       m_imageDownload(new MetadataImageDownload(this))
@@ -66,23 +65,6 @@ void NetBase::InitProgressDialog()
     }
 }
 
-void NetBase::CreateBusyDialog(const QString &title)
-{
-    if (m_busyPopup)
-        return;
-
-    m_busyPopup = new MythUIBusyDialog(title, m_popupStack,
-        "netvisionbusydialog");
-
-    if (m_busyPopup->Create())
-        m_popupStack->AddScreen(m_busyPopup);
-    else
-    {
-        delete m_busyPopup;
-        m_busyPopup = NULL;
-    }
-}
-
 void NetBase::CleanCacheDir()
 {
     QString cache = QString("%1/cache/netvision-thumbcache")
diff --git a/mythplugins/mythnetvision/mythnetvision/netbase.h b/mythplugins/mythnetvision/mythnetvision/netbase.h
index 403e51c..f4291b0 100644
--- a/mythplugins/mythnetvision/mythnetvision/netbase.h
+++ b/mythplugins/mythnetvision/mythnetvision/netbase.h
@@ -28,7 +28,6 @@ class NetBase : public MythScreenType
     virtual ResultItem *GetStreamItem() = 0;
     virtual void LoadData(void) = 0;
     void InitProgressDialog();
-    void CreateBusyDialog(const QString &title);
     void CleanCacheDir();
     void DownloadVideo(const QString &url, const QString &dest);
     void RunCmdWithoutScreensaver(const QString &cmd);
@@ -45,7 +44,6 @@ class NetBase : public MythScreenType
   protected:
     MythUIImage           *m_thumbImage;
     MythUIStateType       *m_downloadable;
-    MythUIBusyDialog      *m_busyPopup;
     MythScreenStack       *m_popupStack;
     MythUIProgressDialog  *m_progressDialog;
     MetadataImageDownload *m_imageDownload;
diff --git a/mythplugins/mythnetvision/mythnetvision/netsearch.cpp b/mythplugins/mythnetvision/mythnetvision/netsearch.cpp
index cd28bd7..47a2f53 100644
--- a/mythplugins/mythnetvision/mythnetvision/netsearch.cpp
+++ b/mythplugins/mythnetvision/mythnetvision/netsearch.cpp
@@ -259,7 +259,7 @@ void NetSearch::DoSearch()
 
     QString title = tr("Searching %1 for \"%2\"...")
                     .arg(grabber).arg(query);
-    CreateBusyDialog(title);
+    OpenBusyPopup(title);
 
     if (!m_netSearch)
         m_netSearch = new QNetworkAccessManager(this);
@@ -283,7 +283,7 @@ void NetSearch::GetLastResults()
     QString title = tr("Changing to page %1 of search \"%2\"...")
                     .arg(QString::number(m_pagenum))
                     .arg(m_currentSearch);
-    CreateBusyDialog(title);
+    OpenBusyPopup(title);
 
     QUrl req = GetMythXMLSearch(m_mythXML, m_currentSearch,
                                 m_currentCmd, m_pagenum);
@@ -299,7 +299,7 @@ void NetSearch::GetMoreResults()
     QString title = tr("Changing to page %1 of search \"%2\"...")
                     .arg(QString::number(m_pagenum))
                     .arg(m_currentSearch);
-    CreateBusyDialog(title);
+    OpenBusyPopup(title);
 
     QUrl req = GetMythXMLSearch(m_mythXML, m_currentSearch,
                                 m_currentCmd, m_pagenum);
@@ -308,11 +308,7 @@ void NetSearch::GetMoreResults()
 
 void NetSearch::SearchFinished(void)
 {
-    if (m_busyPopup)
-    {
-        m_busyPopup->Close();
-        m_busyPopup = NULL;
-    }
+    CloseBusyPopup();
 
     Search *item = new Search();
     QByteArray data = m_reply->readAll();
@@ -352,11 +348,7 @@ void NetSearch::SearchFinished(void)
 
 void NetSearch::SearchTimeout(Search *)
 {
-    if (m_busyPopup)
-    {
-        m_busyPopup->Close();
-        m_busyPopup = NULL;
-    }
+    CloseBusyPopup();
 
     QString message = tr("Timed out waiting for query to "
                          "finish.  API might be down.");
diff --git a/mythplugins/mythnetvision/mythnetvision/nettree.cpp b/mythplugins/mythnetvision/mythnetvision/nettree.cpp
index 33c9580..f676668 100644
--- a/mythplugins/mythnetvision/mythnetvision/nettree.cpp
+++ b/mythplugins/mythnetvision/mythnetvision/nettree.cpp
@@ -857,11 +857,7 @@ void NetTree::RunRSSEditor()
 
 void NetTree::DoTreeRefresh()
 {
-    if (m_busyPopup)
-    {
-        m_busyPopup->Close();
-        m_busyPopup = NULL;
-    }
+    CloseBusyPopup();
 
     TreeRefresh();
 }
@@ -886,7 +882,7 @@ void NetTree::UpdateRSS()
         return;
 
     QString title(tr("Updating RSS.  This could take a while..."));
-    CreateBusyDialog(title);
+    OpenBusyPopup(title);
 
     RSSManager *rssMan = new RSSManager();
     connect(rssMan, SIGNAL(finished()), this, SLOT(DoTreeRefresh()));
@@ -900,7 +896,7 @@ void NetTree::UpdateTrees()
         return;
 
     QString title(tr("Updating Site Maps.  This could take a while..."));
-    CreateBusyDialog(title);
+    OpenBusyPopup(title);
     m_gdt->refreshAll();
 }
 
-- 
1.7.10.2

