From eb17a56d137c76cf8a84c43d192b72d93338ccf5 Mon Sep 17 00:00:00 2001
From: John Poet <jpoet@mythtv.org>
Date: Tue, 6 May 2014 13:50:57 -0600
Subject: [PATCH 1/9] Honor the disabled state in buttonlist items.

---
 mythtv/libs/libmythui/mythuibuttonlist.cpp |   25 +++++++++++++++++++++++--
 mythtv/libs/libmythui/mythuibuttonlist.h   |    1 +
 2 files changed, 24 insertions(+), 2 deletions(-)

diff --git a/mythtv/libs/libmythui/mythuibuttonlist.cpp b/mythtv/libs/libmythui/mythuibuttonlist.cpp
index dab43e4..a2e00f1 100644
--- a/mythtv/libs/libmythui/mythuibuttonlist.cpp
+++ b/mythtv/libs/libmythui/mythuibuttonlist.cpp
@@ -27,6 +27,9 @@ MythUIButtonList::MythUIButtonList(MythUIType *parent, const QString &name)
     m_showArrow = true;
     m_showScrollBar = true;
 
+    connect(this, SIGNAL(Enabling()), this, SLOT(ToggleEnabled()));
+    connect(this, SIGNAL(Disabling()), this, SLOT(ToggleEnabled()));
+
     Const();
 }
 
@@ -42,6 +45,9 @@ MythUIButtonList::MythUIButtonList(MythUIType *parent, const QString &name,
     m_Initiator = true;
     m_EnableInitiator = true;
 
+    connect(this, SIGNAL(Enabling()), this, SLOT(ToggleEnabled()));
+    connect(this, SIGNAL(Disabling()), this, SLOT(ToggleEnabled()));
+
     Const();
 }
 
@@ -121,6 +127,12 @@ void MythUIButtonList::Deselect()
     SetActive(false);
 }
 
+void MythUIButtonList::ToggleEnabled()
+{
+    if (m_initialized)
+        Update();
+}
+
 void MythUIButtonList::SetDrawFromBottom(bool draw)
 {
     m_drawFromBottom = draw;
@@ -3402,7 +3414,9 @@ void MythUIButtonListItem::SetToRealButton(MythUIStateType *button, bool selecte
 
     QString state;
 
-    if (selected)
+    if (!m_parent->IsEnabled())
+        state = "disabled";
+    else if (selected)
     {
         button->MoveToTop();
         state = m_parent->m_active ? "selectedactive" : "selectedinactive";
@@ -3420,7 +3434,14 @@ void MythUIButtonListItem::SetToRealButton(MythUIStateType *button, bool selecte
     {
         LOG(VB_GENERAL, LOG_ERR, QString("Failed to query buttonlist state: %1")
             .arg(state));
-        return;
+        if (state == "disabled")
+        {
+            state = "inactive";
+            if (!button->GetState(state))
+                state = "active";
+        }
+        else
+            return;
     }
 
     buttonstate->Reset();
diff --git a/mythtv/libs/libmythui/mythuibuttonlist.h b/mythtv/libs/libmythui/mythuibuttonlist.h
index afdb4e2..c62862c 100644
--- a/mythtv/libs/libmythui/mythuibuttonlist.h
+++ b/mythtv/libs/libmythui/mythuibuttonlist.h
@@ -205,6 +205,7 @@ class MUI_PUBLIC MythUIButtonList : public MythUIType
   public slots:
     void Select();
     void Deselect();
+    void ToggleEnabled();
 
   signals:
     void itemSelected(MythUIButtonListItem* item);
-- 
1.7.10.2

