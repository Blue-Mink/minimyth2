From 40451cc6b684cfda7633cb7c3b08dadc560d1e8c Mon Sep 17 00:00:00 2001
From: Jean-Yves Avenard <jyavenard@mythtv.org>
Date: Mon, 16 Jun 2014 01:02:43 +1000
Subject: [PATCH 5/7] Add nsecsElapsed() method to MythTimer class

---
 mythtv/libs/libmythbase/mythtimer.cpp |   21 +++++++++++++++++++++
 mythtv/libs/libmythbase/mythtimer.h   |    1 +
 2 files changed, 22 insertions(+)

diff --git a/mythtv/libs/libmythbase/mythtimer.cpp b/mythtv/libs/libmythbase/mythtimer.cpp
index c254cfb..eabb79c 100644
--- a/mythtv/libs/libmythbase/mythtimer.cpp
+++ b/mythtv/libs/libmythbase/mythtimer.cpp
@@ -107,6 +107,27 @@ int MythTimer::elapsed(void) const
     return static_cast<int>(e + m_offset);
 }
 
+/** Returns nanoseconds elapsed since last start() or restart()
+ *
+ * \note If timer had not been started before this is called,
+ *       this returns zero.
+ *
+ * \note If addMSecs() has been called and the total offset applied
+ *       is negative then this can return a negative number.
+ */
+int64_t MythTimer::nsecsElapsed(void) const
+{
+    if (!m_timer.isValid())
+    {
+#ifdef DEBUG_TIMER_API_USAGE
+        assert(0 == "elapsed called without timer being started");
+#endif
+        return 0;
+    }
+
+    return m_timer.nsecsElapsed() + 1000000LL * m_offset;
+}
+
 /** Returns true if start() or restart() has been called at least
  *  once since construction and since any call to stop().
  */
diff --git a/mythtv/libs/libmythbase/mythtimer.h b/mythtv/libs/libmythbase/mythtimer.h
index 83f409d..09785bb 100644
--- a/mythtv/libs/libmythbase/mythtimer.h
+++ b/mythtv/libs/libmythbase/mythtimer.h
@@ -26,6 +26,7 @@ class MBASE_PUBLIC MythTimer
     void addMSecs(int ms);
 
     int elapsed(void) const;
+    int64_t nsecsElapsed(void) const;
     bool isRunning(void) const;
 
   private:
-- 
1.7.10.2

