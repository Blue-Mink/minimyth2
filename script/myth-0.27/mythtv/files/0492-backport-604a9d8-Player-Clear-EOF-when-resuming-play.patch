From 604a9d8db63fababfeb07e1ffc8d45e3f4f2314c Mon Sep 17 00:00:00 2001
From: Lawrence Rust <lvr@softsystem.co.uk>
Date: Wed, 12 Jun 2013 14:55:08 +0100
Subject: [PATCH 44/56] Player: Clear EOF when resuming play

RingBuffer::Read returns 0 (eof) when the buffer is paused.  This causes
ffmpeg to set eof and prevent any further reads by the decoder.

This patch clears the decoder's eof on restarting play which in turn
resets ffmpeg's eof.

Signed-off-by: Lawrence Rust <lvr@softsystem.co.uk>
Signed-off-by: Jean-Yves Avenard <jyavenard@mythtv.org>
---
 mythtv/libs/libmythtv/mythplayer.cpp |    3 +++
 1 file changed, 3 insertions(+)

diff --git a/mythtv/libs/libmythtv/mythplayer.cpp b/mythtv/libs/libmythtv/mythplayer.cpp
index dd9e4c6..c269ab8 100644
--- a/mythtv/libs/libmythtv/mythplayer.cpp
+++ b/mythtv/libs/libmythtv/mythplayer.cpp
@@ -374,6 +374,8 @@ bool MythPlayer::Pause(void)
     audio.Pause(true);
     PauseDecoder();
     PauseBuffer();
+    if (!decoderPaused)
+        PauseDecoder(); // Retry in case audio only stream
     allpaused = decoderPaused && videoPaused && bufferPaused;
     {
         if (FlagIsSet(kVideoIsNull) && decoder)
@@ -398,6 +400,7 @@ bool MythPlayer::Play(float speed, bool normal, bool unpauseaudio)
         return false;
     }
 
+    SetEof(kEofStateNone);
     UnpauseBuffer();
     UnpauseDecoder();
     if (unpauseaudio)
-- 
1.7.10.2

