From 6151169b21af661fc7c695b63fd112e5079ded99 Mon Sep 17 00:00:00 2001
From: Jean-Yves Avenard <jyavenard@mythtv.org>
Date: Wed, 9 Jul 2014 23:15:28 +1000
Subject: [PATCH 04/15] Use myth coding style

(cherry picked from commit fc8584e8b13adb31cb82290e30fa579648646ed9)
---
 mythtv/libs/libmythmetadata/metadatadownload.cpp |   66 +++++++++++++++++++---
 1 file changed, 57 insertions(+), 9 deletions(-)

diff --git a/mythtv/libs/libmythmetadata/metadatadownload.cpp b/mythtv/libs/libmythmetadata/metadatadownload.cpp
index 65b750d..281274f 100644
--- a/mythtv/libs/libmythmetadata/metadatadownload.cpp
+++ b/mythtv/libs/libmythmetadata/metadatadownload.cpp
@@ -144,6 +144,7 @@ void MetadataDownload::run()
             if (list.count() == 1 && list[0]->GetStep() == kLookupSearch)
             {
                 MetadataLookup *newlookup = list.takeFirst();
+
                 newlookup->SetStep(kLookupData);
                 prependLookup(newlookup);
                 continue;
@@ -158,6 +159,7 @@ void MetadataDownload::run()
                 if (bestLookup)
                 {
                     MetadataLookup *newlookup = bestLookup;
+
                     // bestlookup is owned by list, we need an extra reference
                     newlookup->IncrRef();
                     newlookup->SetStep(kLookupData);
@@ -256,8 +258,8 @@ MetadataLookup* MetadataDownload::findBestMatch(MetadataLookupList list,
                     .arg(originaltitle).arg(bestTitle));
 
     // Grab the one item that matches the besttitle (IMPERFECT)
-    for (MetadataLookupList::const_iterator i = list.begin();
-            i != list.end(); ++i)
+    MetadataLookupList::const_iterator i = list.begin();
+    for (; i != list.end(); ++i)
     {
         if ((*i)->GetTitle() == bestTitle)
         {
@@ -291,8 +293,7 @@ MetadataLookupList MetadataDownload::runGrabber(QString cmd, QStringList args,
 
         while (!item.isNull())
         {
-            MetadataLookup *tmp = ParseMetadataItem(item, lookup,
-                passseas);
+            MetadataLookup *tmp = ParseMetadataItem(item, lookup, passseas);
             list.append(tmp);
             // MetadataLookup is to be owned by list
             tmp->DecrRef();
@@ -414,9 +415,11 @@ MetadataLookupList MetadataDownload::readNFO(QString NFOpath,
         if (rf->isOpen())
         {
             bool loaded = rf->SaveAs(nforaw);
+
             if (loaded)
             {
                 QDomDocument doc;
+
                 if (doc.setContent(nforaw, true))
                 {
                     lookup->SetStep(kLookupData);
@@ -437,6 +440,7 @@ MetadataLookupList MetadataDownload::readNFO(QString NFOpath,
         if (!error)
         {
             MetadataLookup *tmp = ParseMetadataMovieNFO(item, lookup);
+
             list.append(tmp);
             // MetadataLookup is owned by the MetadataLookupList returned
             tmp->DecrRef();
@@ -455,24 +459,34 @@ MetadataLookupList MetadataDownload::handleGame(MetadataLookup *lookup)
     if (lookup->GetStep() == kLookupSearch &&
         (!lookup->GetInetref().isEmpty() &&
          lookup->GetInetref() != "00000000"))
+    {
         lookup->SetStep(kLookupData);
+    }
 
     MetaGrabberScript grabber;
 
     if (lookup->GetStep() == kLookupData)
+    {
         // inetref is defined, see if we have a pre-defined grabber
         grabber = MetaGrabberScript::FromInetref(lookup->GetInetref());
+    }
 
     if (!grabber.IsValid())
+    {
         // matching grabber was not found, just use the default
         grabber = MetaGrabberScript::GetType(kGrabberGame);
+    }
 
     if (lookup->GetStep() == kLookupData)
+    {
         // we're just grabbing data
         list = grabber.LookupData(lookup->GetInetref(), lookup);
+    }
     else if (lookup->GetStep() == kLookupSearch)
+    {
         // we're searching
         list = grabber.Search(lookup->GetTitle(), lookup);
+    }
 
     return list;
 }
@@ -502,23 +516,33 @@ MetadataLookupList MetadataDownload::handleMovie(MetadataLookup *lookup)
         if (lookup->GetStep() == kLookupSearch &&
             (!lookup->GetInetref().isEmpty() &&
              lookup->GetInetref() != "00000000"))
+        {
             lookup->SetStep(kLookupData);
+        }
 
         MetaGrabberScript grabber;
 
         if (lookup->GetStep() == kLookupData)
+        {
             // inetref is defined, see if we have a pre-defined grabber
             grabber = MetaGrabberScript::FromInetref(lookup->GetInetref());
+        }
 
         if (!grabber.IsValid())
+        {
             // matching grabber was not found, just use the default
             grabber = MetaGrabberScript::GetType(kGrabberMovie);
+        }
 
         if (lookup->GetStep() == kLookupData)
+        {
             // we're just grabbing data
             list = grabber.LookupData(lookup->GetInetref(), lookup);
+        }
         else if (lookup->GetStep() == kLookupSearch)
+        {
             list = grabber.Search(lookup->GetTitle(), lookup);
+        }
     }
 
     return list;
@@ -533,11 +557,15 @@ MetadataLookupList MetadataDownload::handleTelevision(MetadataLookup *lookup)
     MetaGrabberScript grabber;
     if (!lookup->GetInetref().isEmpty() &&
         lookup->GetInetref() != "00000000")
-            grabber = MetaGrabberScript::FromInetref(lookup->GetInetref());
+    {
+        grabber = MetaGrabberScript::FromInetref(lookup->GetInetref());
+    }
 
     if (!grabber.IsValid())
+    {
         // matching grabber was not found, just use the default
         grabber = MetaGrabberScript::GetType(kGrabberTelevision);
+    }
 
     // there's some special logic going on with searches
     if (lookup->GetStep() == kLookupSearch)
@@ -545,8 +573,10 @@ MetadataLookupList MetadataDownload::handleTelevision(MetadataLookup *lookup)
         // initial search mode
         if (lookup->GetInetref().isEmpty() || 
             lookup->GetInetref() == "00000000")
-                // no inetref given, use the title
-                list = grabber.Search(lookup->GetTitle(), lookup);
+        {
+            // no inetref given, use the title
+            list = grabber.Search(lookup->GetTitle(), lookup);
+        }
         else
         {
             lookup->SetStep(kLookupData);
@@ -555,11 +585,15 @@ MetadataLookupList MetadataDownload::handleTelevision(MetadataLookup *lookup)
         }
     }
     else if (lookup->GetStep() == kLookupData)
+    {
         // we have an inetref, pull data
         list = grabber.LookupData(lookup->GetInetref(), lookup->GetSeason(),
                                   lookup->GetEpisode(), lookup);
+    }
     else if (lookup->GetStep() == kLookupCollection)
+    {
         list = grabber.LookupCollection(lookup->GetCollectionref(), lookup);
+    }
 
     // Collection Fallback
     // If the lookup allows generic metadata, and the specific
@@ -567,7 +601,9 @@ MetadataLookupList MetadataDownload::handleTelevision(MetadataLookup *lookup)
     if (list.isEmpty() &&
         lookup->GetAllowGeneric() &&
         lookup->GetStep() == kLookupData)
-            list = grabber.LookupCollection(lookup->GetCollectionref(), lookup);
+    {
+        list = grabber.LookupCollection(lookup->GetCollectionref(), lookup);
+    }
 
     return list;
 }
@@ -579,21 +615,31 @@ MetadataLookupList MetadataDownload::handleVideoUndetermined(MetadataLookup *loo
     MetaGrabberScript grabber;
     if (!lookup->GetInetref().isEmpty() &&
         lookup->GetInetref() != "00000000")
-            grabber = MetaGrabberScript::FromInetref(lookup->GetInetref());
+    {
+        grabber = MetaGrabberScript::FromInetref(lookup->GetInetref());
+    }
 
     if (!grabber.IsValid())
+    {
         // matching grabber was not found, just use the default
         grabber = MetaGrabberScript::GetType(kGrabberTelevision);
+    }
 
     if (lookup->GetInetref().isEmpty())
+    {
         list = grabber.SearchSubtitle(lookup->GetTitle(),
                                       lookup->GetSubtitle(), lookup, false);
+    }
     else
+    {
         list = grabber.SearchSubtitle(lookup->GetInetref(),
                                       lookup->GetSubtitle(), lookup, false);
+    }
 
     if (list.count() == 1)
+    {
         list[0]->SetStep(kLookupData);
+    }
 
     return list;
 }
@@ -659,6 +705,7 @@ QString MetadataDownload::getMXMLPath(QString filename)
     {
         StorageGroup sg;
         QString fn = sg.FindFile(xurl.path());
+
         if (!fn.isEmpty() && QFile::exists(fn))
             ret = xmlname;
     }
@@ -687,6 +734,7 @@ QString MetadataDownload::getNFOPath(QString filename)
     {
         StorageGroup sg;
         QString fn = sg.FindFile(nurl.path());
+
         if (!fn.isEmpty() && QFile::exists(fn))
             ret = nfoname;
     }
-- 
1.7.10.2

