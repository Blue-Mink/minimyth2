From a669bc9f4f59f9a043a0c09a29b961dc4d4f67bf Mon Sep 17 00:00:00 2001
From: Roger Siddons <dizygotheca@ntlworld.com>
Date: Thu, 30 Oct 2014 19:05:59 +0000
Subject: [PATCH 09/11] New Image Gallery: Add logging

Signed-off-by: Paul Harrison <pharrison@mythtv.org>
---
 mythtv/libs/libmythmetadata/imagescanthread.cpp    |    6 +++--
 .../libs/libmythmetadata/imagethumbgenthread.cpp   |    4 ++++
 mythtv/programs/mythbackend/services/image.cpp     |   25 ++++++++++++++------
 mythtv/programs/mythfrontend/galleryfilehelper.cpp |    4 ++--
 4 files changed, 28 insertions(+), 11 deletions(-)

diff --git a/mythtv/libs/libmythmetadata/imagescanthread.cpp b/mythtv/libs/libmythmetadata/imagescanthread.cpp
index 84d2291..7a30f8b 100644
--- a/mythtv/libs/libmythmetadata/imagescanthread.cpp
+++ b/mythtv/libs/libmythmetadata/imagescanthread.cpp
@@ -61,7 +61,7 @@ void ImageScanThread::run()
         return;
     }
 
-    LOG(VB_GENERAL, LOG_DEBUG, QString("Syncronization started"));
+    LOG(VB_GENERAL, LOG_DEBUG, "Syncronisation started");
 
     m_progressCount       = 0;
     m_progressTotalCount  = 0;
@@ -74,7 +74,7 @@ void ImageScanThread::run()
 
     QStringList paths = iu->GetStorageDirs();
 
-    // Get the total list of files and directories that will be synced.
+    // Get the total list of directories that will be synced.
     // This is only an additional information that the themer can show.
     for (int i = 0; i < paths.size(); ++i)
     {
@@ -117,6 +117,8 @@ void ImageScanThread::run()
     m_progressCount       = 0;
     m_progressTotalCount  = 0;
 
+    LOG(VB_GENERAL, LOG_DEBUG, "Syncronisation complete");
+
     RunEpilog();
 }
 
diff --git a/mythtv/libs/libmythmetadata/imagethumbgenthread.cpp b/mythtv/libs/libmythmetadata/imagethumbgenthread.cpp
index 89f6b68..6166f6f 100644
--- a/mythtv/libs/libmythmetadata/imagethumbgenthread.cpp
+++ b/mythtv/libs/libmythmetadata/imagethumbgenthread.cpp
@@ -115,7 +115,10 @@ void ImageThumbGenThread::CreateImageThumbnail(ImageMetadata *im)
 
     QImage image;
     if (!image.load(imageFileName))
+    {
+        LOG(VB_FILE, LOG_ERR, QString("Failed to create pic thumbnail for %1").arg(imageFileName));
         return;
+    }
 
     QMatrix matrix;
     switch (im->GetOrientation())
@@ -167,6 +170,7 @@ void ImageThumbGenThread::CreateImageThumbnail(ImageMetadata *im)
     // save the image in the thumbnail directory
     if (image.save(im->m_thumbFileNameList->at(0)))
     {
+        LOG(VB_FILE, LOG_DEBUG, QString("Created pic thumbnail for %1").arg(imageFileName));
         QString msg = "IMAGE_THUMB_CREATED %1";
         gCoreContext->SendMessage(msg.arg(im->m_id));
     }
diff --git a/mythtv/programs/mythbackend/services/image.cpp b/mythtv/programs/mythbackend/services/image.cpp
index f2cae0a..7ef7d9c 100644
--- a/mythtv/programs/mythbackend/services/image.cpp
+++ b/mythtv/programs/mythbackend/services/image.cpp
@@ -119,7 +119,8 @@ QString Image::GetImageInfo( int id, const QString &tag )
 
     if (im->m_fileName.isEmpty())
     {
-        LOG(VB_GENERAL, LOG_ERR, "GetImageInfo - File not found in DB.");
+        LOG(VB_GENERAL, LOG_ERR,
+            QString("GetImageInfo - Image %1 not found in DB").arg(id));
         delete im;
         return QString();
     }
@@ -185,7 +186,8 @@ DTC::ImageMetadataInfoList* Image::GetImageInfoList( int id )
 
     if (im->m_fileName.isEmpty())
     {
-        LOG(VB_GENERAL, LOG_ERR, "GetImageInfoList - File not found in DB");
+        LOG(VB_GENERAL, LOG_ERR,
+            QString("GetImageInfoList - Image %1 not found in DB").arg(id));
         delete im;
         return NULL;
     }
@@ -288,21 +290,28 @@ bool Image::RemoveImage( int id )
 
     if (im->m_fileName.isEmpty())
     {
-        LOG(VB_GENERAL, LOG_ERR, "RemoveImage - File not found");
+        LOG(VB_GENERAL, LOG_ERR,
+            QString("RemoveImage - Image %1 not found in DB").arg(id));
         delete im;
         return false;
     }
 
     if (!QFile::exists( im->m_fileName ))
     {
-        LOG(VB_GENERAL, LOG_ERR, "RemoveImage - File does not exist.");
+        LOG(VB_GENERAL, LOG_ERR,
+            QString("RemoveImage - File %1 not found for image %2")
+            .arg(im->m_fileName)
+            .arg(id));
         delete im;
         return false;
     }
 
     if (!QFile::remove( im->m_fileName ))
     {
-        LOG(VB_GENERAL, LOG_ERR, "RemoveImage - Could not delete file.");
+        LOG(VB_GENERAL, LOG_ERR,
+            QString("RemoveImage - Could not delete file %1 for image %2")
+            .arg(im->m_fileName)
+            .arg(id));
         delete im;
         return false;
     }
@@ -426,7 +435,8 @@ bool Image::CreateThumbnail(int id)
 
     if (im->m_fileName.isEmpty())
     {
-        LOG(VB_GENERAL, LOG_ERR, "QueueCreateThumbnail - File not found");
+        LOG(VB_GENERAL, LOG_ERR,
+            QString("CreateThumbnail - Image %1 not found in DB").arg(id));
         delete im;
         return false;
     }
@@ -443,7 +453,8 @@ bool Image::RecreateThumbnail(int id)
 
     if (im->m_fileName.isEmpty())
     {
-        LOG(VB_GENERAL, LOG_ERR, "QueueCreateThumbnail - File not found");
+        LOG(VB_GENERAL, LOG_ERR,
+            QString("RecreateThumbnail - Image %1 not found in DB").arg(id));
         delete im;
         return false;
     }
diff --git a/mythtv/programs/mythfrontend/galleryfilehelper.cpp b/mythtv/programs/mythfrontend/galleryfilehelper.cpp
index 7348e3a..76a4cba 100644
--- a/mythtv/programs/mythfrontend/galleryfilehelper.cpp
+++ b/mythtv/programs/mythfrontend/galleryfilehelper.cpp
@@ -428,13 +428,13 @@ QByteArray GalleryFileHelper::SendRequest(QUrl &url,
         if (reply->error() == QNetworkReply::NoError)
         {
             LOG(VB_GENERAL, LOG_DEBUG,
-                QString("GalleryFileHelper SendRequest ok"));
+                QString("GalleryFileHelper SendRequest ok [%1]").arg(url.toString()));
             ba = reply->readAll();
         }
         else
         {
             LOG(VB_GENERAL, LOG_DEBUG,
-                QString("GalleryFileHelper SendRequest error: %1")
+                QString("GalleryFileHelper SendRequest error: %1 [%2]").arg(url.toString())
                 .arg(reply->errorString()));
         }
         reply->deleteLater();
-- 
1.7.10.2

