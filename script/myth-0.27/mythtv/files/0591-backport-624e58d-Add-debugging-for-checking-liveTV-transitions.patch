From 624e58dbd9de7a1087e13e2d89ad36e7ba73d87a Mon Sep 17 00:00:00 2001
From: Jean-Yves Avenard <jyavenard@mythtv.org>
Date: Sun, 10 Aug 2014 20:19:34 +1000
Subject: [PATCH] Add debugging for checking liveTV transitions.

set DEBUG_LIVETV_TRANSITION
---
 mythtv/libs/libmythtv/tv_play.cpp |   16 ++++++++++++++--
 mythtv/libs/libmythtv/tv_play.h   |    1 +
 2 files changed, 15 insertions(+), 2 deletions(-)

diff --git a/mythtv/libs/libmythtv/tv_play.cpp b/mythtv/libs/libmythtv/tv_play.cpp
index c57ec98..c400ad4 100644
--- a/mythtv/libs/libmythtv/tv_play.cpp
+++ b/mythtv/libs/libmythtv/tv_play.cpp
@@ -7927,7 +7927,7 @@ void TV::ToggleOSD(PlayerContext *ctx, bool includeStatusOSD)
         osdInfo info;
         if (ctx->CalcPlayerSliderPosition(info))
         {
-            info.text["title"] = paused ? tr("Paused") : tr("Position");
+            info.text["title"] = (paused ? tr("Paused") : tr("Position")) + GetLiveTVIndex();
             UpdateOSDStatus(ctx, info, kOSDFunctionalType_Default,
                             paused ? kOSDTimeout_None : kOSDTimeout_Med);
             SetUpdateOSDPosition(true);
@@ -8047,7 +8047,7 @@ void TV::UpdateOSDSeekMessage(const PlayerContext *ctx,
     {
         int osdtype = (doSmartForward) ? kOSDFunctionalType_SmartForward :
             kOSDFunctionalType_Default;
-        info.text["title"] = mesg;
+        info.text["title"] = mesg + GetLiveTVIndex();
         UpdateOSDStatus(ctx, info, osdtype, timeout);
         SetUpdateOSDPosition(true);
     }
@@ -13578,4 +13578,16 @@ void TV::ReturnPlayerLock(const PlayerContext *&ctx) const
     ctx = NULL;
 }
 
+QString TV::GetLiveTVIndex(void) const
+{
+#ifdef DEBUG_LIVETV_TRANSITION
+    return (ctx->tvchain ?
+            QString(" (%1/%2)")
+                .arg(ctx->tvchain->GetCurPos())
+                .arg(ctx->tvchain->TotalSize()) : QString());
+#else
+    return QString();
+#endif
+}
+
 /* vim: set expandtab tabstop=4 shiftwidth=4: */
diff --git a/mythtv/libs/libmythtv/tv_play.h b/mythtv/libs/libmythtv/tv_play.h
index 3b26b18..faac23d 100644
--- a/mythtv/libs/libmythtv/tv_play.h
+++ b/mythtv/libs/libmythtv/tv_play.h
@@ -776,6 +776,7 @@ class MTV_PUBLIC TV : public QObject, public MenuItemDisplayer
 
     // for temp debugging only..
     int find_player_index(const PlayerContext*) const;
+    QString GetLiveTVIndex(void) const;
 
   private:
     // Configuration variables from database
-- 
1.7.10.2

