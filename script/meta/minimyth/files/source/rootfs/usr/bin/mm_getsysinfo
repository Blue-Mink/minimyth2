#!/bin/sh

. /etc/rc.d/functions

file="/var/log/system-info"

# Close STDOUT file descriptor
exec 1<&-
# Close STDERR FD
exec 2<&-
# Open STDOUT as $LOG_FILE file for read and write.
exec 1<>$file
# Redirect STDERR to STDOUT
exec 2>&1

store() {
  echo " "
  echo "${1}"
  echo "--------------------------------------------------------------------------------"
  ${2}
  echo "--------------------------------------------------------------------------------"
  echo " "
  echo " "
  echo " "
}

store "/var/log/messgaes"     "cat /var/log/messages"
store "/var/log/mythfrontend" "cat /var/log/mythfrontend"
store "/var/log/Xorg.log"     "cat /var/log/Xorg.0.0.log"
store "minimyth.conf"         "cat /etc/minimyth.d/minimyth.conf"
store "xorg.conf"             "cat /etc/X11/xorg.conf"
store "minimyth vars"         "cat /etc/conf.d/minimyth"
store "dhcp offer"            "cat /etc/conf.d/dhcp"
store "dhcp.overrides"        "cat /etc/conf.d/dhcp.override"
store "lspci"                 "lspci -kbnn"
store "lsusb"                 "lsusb -t"
store "alsa phy devices"      "aplay -l"
store "alsa logical devices"  "aplay -L"
store "alsa controls"         "amixer"
store "vainfo"                "vainfo"
store "vdpauinfo"             "vdpauinfo"
store "dmesg"                 "dmesg"
store "lsmod"                 "lsmod"
store "DMI modalias"          "cat /sys/class/dmi/id/modalias"
store "ifconfig"              "ifconfig"
store "netstat -r"            "netstat -r"
store "netstat -Wpant 3306|6543'" "netstat -Wpant | grep '3306|6543'"
store "/proc/acpi/wakeup"     "cat /proc/acpi/wakeup"
store "v4l2 decoder"          "v4l2-ctl -D --list-formats-ext --list-formats-out-ext"
store "drm modes"             "modetest"
store "DVFS stats"            "cat /sys/devices/system/cpu/cpufreq/policy0/stats/time_in_state"
store "temp_zone0"            "cat /sys/class/thermal/thermal_zone0/temp"
store "temp_zone1"            "cat /sys/class/thermal/thermal_zone1/temp"

echo " "
echo "mm_hw_detect"
echo "--------------------------------------------------------------------------------"
files=`find /var/cache/minimyth -type f`
for f in ${files}; do
  echo "${f}:"
  cat ${f}
  echo " "
done
echo "--------------------------------------------------------------------------------"

echo " "
echo " "
echo "CPU/DDR/vpu clocks"
echo "--------------------------------------------------------------------------------"

mount -t debugfs debugfs /sys/kernel/debug
grep -E "cpu|ddr|vpu" /sys/kernel/debug/clk/clk_summary
umount /sys/kernel/debug

echo "--------------------------------------------------------------------------------"
echo " "
echo " "
echo " "

exit 0
