#!/bin/sh

. /etc/rc.d/functions

# Only allow one running instance of mm_external.
pids=`/bin/pidof mm_external`
instances=`/bin/echo ${pids} | /usr/bin/wc -w`
if /usr/bin/test ${instances} -ne 1 ; then
   exit 1
fi

case $1 in
    ampli_power_off)
        /usr/bin/test -n "${MM_EXTERNAL_AMPLI_POWER_OFF}" && echo ${MM_EXTERNAL_AMPLI_POWER_OFF} > /var/run/irsend_fifo &
        ;;
    ampli_power_on)
        /usr/bin/test -n "${MM_EXTERNAL_AMPLI_POWER_ON}" && echo ${MM_EXTERNAL_AMPLI_POWER_ON} > /var/run/irsend_fifo &
        ;;
    tv_power_off)
        /usr/bin/test -n "${MM_EXTERNAL_TV_POWER_OFF}" && echo ${MM_EXTERNAL_TV_POWER_OFF} > /var/run/irsend_fifo &
        ;;
    tv_power_on)
        /usr/bin/test -n "${MM_EXTERNAL_TV_POWER_ON}" && echo ${MM_EXTERNAL_TV_POWER_ON} > /var/run/irsend_fifo &
        ;;
    power_on_mm_boot)
        /usr/bin/test -n "${MM_EXTERNAL_POWER_ON_MM_BOOT}" && echo ${MM_EXTERNAL_POWER_ON_MM_BOOT} > /var/run/irsend_fifo &
        ;;
    volume_down)
        /usr/bin/test -n "${MM_EXTERNAL_VOLUME_DOWN}" && echo ${MM_EXTERNAL_VOLUME_DOWN} > /var/run/irsend_fifo &
        ;;
    volume_up)
        /usr/bin/test -n "${MM_EXTERNAL_VOLUME_UP}" && echo ${MM_EXTERNAL_VOLUME_UP} > /var/run/irsend_fifo &
        ;;
    volume_mute)
        /usr/bin/test -n "${MM_EXTERNAL_VOLUME_MUTE}" && echo ${MM_EXTERNAL_VOLUME_MUTE} > /var/run/irsend_fifo &
        ;;
esac

exit 0
