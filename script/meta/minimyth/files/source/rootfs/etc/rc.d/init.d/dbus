#!/bin/sh
################################################################################
# dbus
################################################################################
. /etc/rc.d/functions

start() {

    if /usr/bin/test -e "/usr/bin/dbus-uuidgen" ; then
        mm_message_output info "initializing dbus ..."
        /usr/bin/logger -s -t minimyth -p "local0.info" "[init.d/dbus] Initializing dbus-uuid..."
        if /usr/bin/test ! -e "/var/lib/dbus" ; then
            mkdir -p -m 0755 /var/lib/dbus
        fi
        /usr/bin/dbus-uuidgen > /var/lib/dbus/machine-id
        chmod 0644 /var/lib/dbus/machine-id
    fi

    if /usr/bin/test -e "/usr/bin/dbus-daemon" && /usr/bin/test -e "/etc/dbus-1/system.conf" ; then

        mm_message_output info "starting dbus daemon..."
        /usr/bin/logger -s -t minimyth -p "local0.info" "[init.d/dbus] Starting dbus daemon..."

        if /usr/bin/test ! -e "/var/run/dbus" ; then
            mkdir -p -m 0755 /var/run/dbus
        fi

        /usr/bin/dbus-daemon --config-file=/etc/dbus-1/system.conf

#        if /usr/bin/test -e "/usr/lib/udisks/udisks-daemon" ; then
#            /bin/sleep 2
#            mm_message_output info "starting udisks daemon..."
#            /usr/bin/logger -s -t minimyth -p "local0.info" "[dbus] Starting udisks daemon..."
#            /usr/lib/udisks/udisks-daemon > /var/log/udisks.log &
#        fi
    fi
}

stop() {
    mm_message_output info "stopping dbus ..."
}

case $1 in
    start) start ;;
    stop)  stop  ;;
esac

exit 0
