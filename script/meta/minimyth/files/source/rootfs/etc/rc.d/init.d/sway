#!/bin/sh
################################################################################
# sway
################################################################################
. /etc/rc.d/functions

start() {

    /bin/touch /var/init/sway.inprogress

    /usr/bin/logger -s -t minimyth -p "local0.info" "[init.d/sway] Starting..."

    if test -z "${XDG_RUNTIME_DIR}"; then 
      export XDG_RUNTIME_DIR=/var/run/sway-runtime-dir
      if ! test -d "${XDG_RUNTIME_DIR}"; then
        mkdir "${XDG_RUNTIME_DIR}"
        chmod 0700 "${XDG_RUNTIME_DIR}"
      fi
    fi

    chmod 666 /dev/tty1
    export WLR_DIRECT_TTY=/dev/tty1

    #setcap cap_sys_admin=eip /usr/bin/sway
    chmod +s /usr/bin/sway

    sway -d

    /usr/bin/logger -s -t minimyth -p "local0.info" "[init.d/sway] Started with return code=0..."

    /bin/rm -f /var/init/sway.inprogress
    return 0

}

stop() {

    mm_message_output info "stopping sway server ..."

    if [ -n "`/bin/pidof sway`" ] ; then
        /usr/bin/killall sway
    fi

    return 0
}

case $1 in
    start) start ;;
    stop)  stop  ;;
esac

exit 0
